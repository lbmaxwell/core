crystal_doc_search_index_callback({"repository_name":"github.com/vladfaust/core","body":"# ![Core](https://user-images.githubusercontent.com/7955682/40578252-6f1929b2-6119-11e8-9348-81505cec939f.png)\n\n[![Built with Crystal](https://img.shields.io/badge/built%20with-crystal-000000.svg?style=flat-square)](https://crystal-lang.org/)\n[![Build status](https://img.shields.io/travis/vladfaust/core/master.svg?style=flat-square)](https://travis-ci.org/vladfaust/core)\n[![Docs](https://img.shields.io/badge/docs-available-brightgreen.svg?style=flat-square)](https://github.vladfaust.com/core)\n[![Releases](https://img.shields.io/github/release/vladfaust/core.svg?style=flat-square)](https://github.com/vladfaust/core/releases)\n[![Awesome](https://img.shields.io/badge/style-awesome-lightgrey.svg?longCache=true&style=flat-square&label=&colorA=fc60a8&colorB=494368&status=ok&logo=data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIgICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiICAgd2lkdGg9IjE1NC43ODEyNW1tIiAgIGhlaWdodD0iODAuMTE1ODI5bW0iICAgdmlld0JveD0iMCAwIDE1NC43ODEyNSA4MC4xMTU4MjkiICAgdmVyc2lvbj0iMS4xIiAgIGlkPSJzdmc4IiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTIuMSByMTUzNzEiICAgc29kaXBvZGk6ZG9jbmFtZT0iYXdlc29tZS5zdmciPiAgPGRlZnMgICAgIGlkPSJkZWZzMiIgLz4gIDxzb2RpcG9kaTpuYW1lZHZpZXcgICAgIGlkPSJiYXNlIiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiICAgICBib3JkZXJvcGFjaXR5PSIxLjAiICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIgICAgIGlua3NjYXBlOnpvb209IjAuNyIgICAgIGlua3NjYXBlOmN4PSIxMzMuMTU2NTYiICAgICBpbmtzY2FwZTpjeT0iMTAxLjUzNjMiICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0ibW0iICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiICAgICBzaG93Z3JpZD0iZmFsc2UiICAgICBmaXQtbWFyZ2luLXRvcD0iMCIgICAgIGZpdC1tYXJnaW4tbGVmdD0iMCIgICAgIGZpdC1tYXJnaW4tcmlnaHQ9IjAiICAgICBmaXQtbWFyZ2luLWJvdHRvbT0iMCIgICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTkyMCIgICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjEwMTciICAgICBpbmtzY2FwZTp3aW5kb3cteD0iLTgiICAgICBpbmtzY2FwZTp3aW5kb3cteT0iLTgiICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIxIiAvPiAgPG1ldGFkYXRhICAgICBpZD0ibWV0YWRhdGE1Ij4gICAgPHJkZjpSREY+ICAgICAgPGNjOldvcmsgICAgICAgICByZGY6YWJvdXQ9IiI+ICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4gICAgICAgIDxkYzp0eXBlICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+ICAgICAgPC9jYzpXb3JrPiAgICA8L3JkZjpSREY+ICA8L21ldGFkYXRhPiAgPGcgICAgIGlua3NjYXBlOmxhYmVsPSJMYXllciAxIiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIgICAgIGlkPSJsYXllcjEiICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMzIuMjA5MjQzLC05OS4zODI3MDcpIj4gICAgPHBhdGggICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZjtzdHJva2Utd2lkdGg6MC4yNjQ1ODMzMiIgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIgICAgICAgZD0ibSAxODYuOTkwNDksMTM1LjgxNTgzIC0zOS42ODc1LC0zNi40MDY2NjQgLTUuNTgyNzEsNi4wODU0MTQgMzMuMDcyOTIsMzAuMzIxMjUgSCA0NC40MzI5OTQgTCA3Ny41MDU5MSwxMDUuNDY4MTIgNzEuOTIzMjAyLDk5LjM4MjcwNyAzMi4yMzU3MDMsMTM1LjgxNTgzIGggLTAuMDI2NDYgdiAyMy45OTc3MSBjIDAsMTAuODQ3OTEgMTAuNDUxMDQxLDE5LjY4NSAyMy4yODMzMzIsMTkuNjg1IGggMjQuNDczOTU4IGMgMTIuODMyMjkyLDAgMjMuMjgzMzM3LC04LjgzNzA5IDIzLjI4MzMzNywtMTkuNjg1IHYgLTE1Ljc2OTE3IGggMTIuNyB2IDE1Ljc2OTE3IGMgMCwxMC44NDc5MSAxMC40NTEwNCwxOS42ODUgMjMuMjgzMzMsMTkuNjg1IGggMjQuNDczOTYgYyAxMi44MzIyOSwwIDIzLjI4MzMzLC04LjgzNzA5IDIzLjI4MzMzLC0xOS42ODUgeiIgICAgICAgaWQ9InBhdGg0NDg3IiAvPiAgPC9nPjwvc3ZnPg==)](https://github.com/veelenga/awesome-crystal)\n[![vladfaust.com](https://img.shields.io/badge/style-.com-lightgrey.svg?longCache=true&style=flat-square&label=vladfaust&colorB=0a83d8)](https://vladfaust.com)\n\nCore is an expressive modular ORM for [Crystal](https://crystal-lang.org) featuring:\n\n- ⚡️ **Efficiency** based on [Crystal](https://crystal-lang.org) performance\n- ✨ **Expressiveness** with powerful DSL and lesser code\n- 💼 **Safety** with strictly typed attributes\n\n## About\n\nCore does not follow Active Record pattern, it's more like a data-mapping solution. There is a concept of Repository, which is basically a gateway to the database. For example:\n\n```crystal\nrepo = Core::Repository.new(db)\nusers = repo.query(User, \"SELECT * FROM users WHERE id > 42\")\nusers.class # => Array(User)\n```\n\nCore also has a plently of features, including:\n\n- Expressive Query builder, either standalone or module, allowing to use constructions like `Post.join(:author).where(author: user)`, which turns into a plain SQL\n- References preloader (the example above would return a `Post` which has `#author = <User @id=42>` attribute)\n- Validations module allowing to perform both inline and custom validations (`user.valid? # => true`)\n\nHowever, Core is designed to be minimal, so it doesn't perform task you may got used to, for example, it doesn't do database migrations itself. You may use [migrate](https://github.com/vladfaust/migrate.cr) instead.\n\n## Installation\n\nAdd this to your application's `shard.yml`:\n\n```yaml\ndependencies:\n  core:\n    github: vladfaust/core\n    version: ~> 0.4.0 # See actual version in releases\n```\n\nThis shard follows [Semantic Versioning v2.0.0](http://semver.org/), so check [releases](https://github.com/vladfaust/core/releases) and change the `version` accordingly.\n\n## Basic example\n\nAssuming following database schema:\n\n```sql\nCREATE TABLE users(\n  id          SERIAL        PRIMARY KEY,\n  name        VARCHAR(100)  NOT NULL,\n  created_at  TIMESTAMPTZ   NOT NULL  DEFAULT NOW()\n);\n\nCREATE TABLE posts(\n  id          SERIAL      PRIMARY KEY,\n  author_id   INT         NOT NULL  REFERENCES users (id),\n  content     TEXT        NOT NULL,\n  created_at  TIMESTAMPTZ NOT NULL  DEFAULT NOW(),\n  updated_at  TIMESTAMPTZ\n);\n```\n\n```crystal\nrequire \"core\"\nrequire \"pg\" # Or maybe another driver\n\nclass User\n  include Core::Schema\n  include Core::Query\n  include Core::Validations\n\n  schema :users do\n    primary_key :id\n    reference :posts, Array(Post), foreign_key: :author_id\n\n    field :name, String, validate: {size: (3..100)}\n    field :created_at, Time, db_default: true # Means that DB is handling the default value\n  end\nend\n\nclass Post\n  include Core::Schema\n  include Core::Query\n  include Core::Validations\n\n  schema :posts do\n    primary_key :id\n    reference :author, User, key: :author_id\n\n    field :content, String\n    field :created_at, Time, db_default: true\n    field :updated_at, Time?\n  end\nend\n\ndb = DB.open(ENV[\"DATABASE_URL\"])\nquery_logger = Core::Logger::IO.new(STDOUT)\nrepo = Core::Repository.new(db, query_logger)\n\nuser = User.new(name: \"Vl\")\nuser.valid? # => false\nuser.errors # => [{:name => \"must have size in range of 3..100\"}]\nuser.name = \"Vlad\"\nuser = repo.insert(user)\n\npost = repo.insert(Post.new(author: user, content: \"What a beauteful day!\")) # Oops\n\npost.content = \"What a beautiful day!\"\nrepo.update(post)\n\nposts = repo.query(Post.where(author: user).join(:author))\nputs posts.first.inspect\n# => <Post @author=<User @name=\"Vlad\"> @content=\"What a beautiful day!\">\n```\n\n## Testing\n\n1. Apply migration from `./spec/migration.sql`\n2. Run `env DATABASE_URL=your_database_url crystal spec`\n\n## Contributing\n\n1. Fork it ( https://github.com/vladfaust/core/fork )\n2. Create your feature branch (git checkout -b my-new-feature)\n3. Commit your changes (git commit -am 'Add some feature')\n4. Push to the branch (git push origin my-new-feature)\n5. Create a new Pull Request\n\n## Contributors\n\n- [@vladfaust](https://github.com/vladfaust) Vlad Faust - creator, maintainer\n","program":{"html_id":"github.com/vladfaust/core/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"github.com/vladfaust/core","program":true,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"github.com/vladfaust/core/Array","path":"Array.html","kind":"class","full_name":"Array(T)","name":"Array","abstract":false,"superclass":{"html_id":"github.com/vladfaust/core/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"github.com/vladfaust/core/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"github.com/vladfaust/core/Indexable","kind":"module","full_name":"Indexable","name":"Indexable"},{"html_id":"github.com/vladfaust/core/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"github.com/vladfaust/core/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"},{"html_id":"github.com/vladfaust/core/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"github.com/vladfaust/core/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"ext/array.cr","line_number":3,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/ext/array.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[{"html_id":"github.com/vladfaust/core/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"github.com/vladfaust/core/Indexable","kind":"module","full_name":"Indexable","name":"Indexable"}],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":"An `Array` is an ordered, integer-indexed collection of objects of type T.\n\nArray indexing starts at 0. A negative index is assumed to be\nrelative to the end of the array: -1 indicates the last element,\n-2 is the next to last element, and so on.\n\nAn `Array` can be created using the usual `new` method (several are provided), or with an array literal:\n\n```\nArray(Int32).new  # => []\n[1, 2, 3]         # Array(Int32)\n[1, \"hello\", 'x'] # Array(Int32 | String | Char)\n```\n\nAn `Array` can have mixed types, meaning T will be a union of types, but these are determined\nwhen the array is created, either by specifying T or by using an array literal. In the latter\ncase, T will be set to the union of the array literal elements' types.\n\nWhen creating an empty array you must always specify T:\n\n```\n[] of Int32 # same as Array(Int32)\n[]          # syntax error\n```\n\nAn `Array` is implemented using an internal buffer of some capacity\nand is reallocated when elements are pushed to it when more capacity\nis needed. This is normally known as a [dynamic array](http://en.wikipedia.org/wiki/Dynamic_array).\n\nYou can use a special array literal syntax with other types too, as long as they define an argless\n`new` method and a `<<` method. `Set` is one such type:\n\n```\nset = Set{1, 2, 3} # => Set{1, 2, 3}\nset.class          # => Set(Int32)\n```\n\nThe above is the same as this:\n\n```\nset = Set(typeof(1, 2, 3)).new\nset << 1\nset << 2\nset << 3\n```","summary":"<p>An <code><a href=\"Array.html\">Array</a></code> is an ordered, integer-indexed collection of objects of type T.</p>","class_methods":[{"id":"from_rs(rs:DB::ResultSet)-class-method","html_id":"from_rs(rs:DB::ResultSet)-class-method","name":"from_rs","doc":"Map `#from_rs` to `T`.","summary":"<p>Map <code><a href=\"Array.html#from_rs%28rs%3ADB%3A%3AResultSet%29-class-method\">#from_rs</a></code> to <code>T</code>.</p>","abstract":false,"args":[{"name":"rs","doc":null,"default_value":"","external_name":"rs","restriction":"DB::ResultSet"}],"args_string":"(rs : DB::ResultSet)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/ext/array.cr#L5","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/ext/array.cr#L5","def":{"name":"from_rs","args":[{"name":"rs","doc":null,"default_value":"","external_name":"rs","restriction":"DB::ResultSet"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"T.from_rs(rs)"}},{"id":"primary_key-class-method","html_id":"primary_key-class-method","name":"primary_key","doc":"Map `Core::Schema.primary_key` to `T`.","summary":"<p>Map <code><a href=\"Core/Schema.html#primary_key%28name%2Ctype_type%3D%3A%3AUnion%28Core%3A%3APrimaryKey%2C%3A%3ANil%29%2C%2A%2Aoptions%29-macro\">Core::Schema.primary_key</a></code> to <code>T</code>.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/ext/array.cr#L15","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/ext/array.cr#L15","def":{"name":"primary_key","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"T.primary_key"}},{"id":"reference_class(ref)-class-method","html_id":"reference_class(ref)-class-method","name":"reference_class","doc":"Map `Core::Schema.reference_class` to `T`.","summary":"<p>Map <code>Core::Schema.reference_class</code> to <code>T</code>.</p>","abstract":false,"args":[{"name":"ref","doc":null,"default_value":"","external_name":"ref","restriction":""}],"args_string":"(ref)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/ext/array.cr#L30","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/ext/array.cr#L30","def":{"name":"reference_class","args":[{"name":"ref","doc":null,"default_value":"","external_name":"ref","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"T.reference_class(ref)"}},{"id":"reference_foreign_key(ref)-class-method","html_id":"reference_foreign_key(ref)-class-method","name":"reference_foreign_key","doc":"Map `Core::Schema.reference_foreign_key` to `T`.","summary":"<p>Map <code>Core::Schema.reference_foreign_key</code> to <code>T</code>.</p>","abstract":false,"args":[{"name":"ref","doc":null,"default_value":"","external_name":"ref","restriction":""}],"args_string":"(ref)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/ext/array.cr#L25","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/ext/array.cr#L25","def":{"name":"reference_foreign_key","args":[{"name":"ref","doc":null,"default_value":"","external_name":"ref","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"T.reference_foreign_key(ref)"}},{"id":"reference_key(ref)-class-method","html_id":"reference_key(ref)-class-method","name":"reference_key","doc":"Map `Core::Schema.reference_key` to `T`.","summary":"<p>Map <code>Core::Schema.reference_key</code> to <code>T</code>.</p>","abstract":false,"args":[{"name":"ref","doc":null,"default_value":"","external_name":"ref","restriction":""}],"args_string":"(ref)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/ext/array.cr#L20","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/ext/array.cr#L20","def":{"name":"reference_key","args":[{"name":"ref","doc":null,"default_value":"","external_name":"ref","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"T.reference_key(ref)"}},{"id":"table_name-class-method","html_id":"table_name-class-method","name":"table_name","doc":"Map `Core::Schema.table_name` to `T`.","summary":"<p>Map <code>Core::Schema.table_name</code> to <code>T</code>.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/ext/array.cr#L10","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/ext/array.cr#L10","def":{"name":"table_name","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"T.table_name"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"github.com/vladfaust/core/Core","path":"Core.html","kind":"module","full_name":"Core","name":"Core","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"core/converter.cr","line_number":3,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converter.cr"},{"filename":"core/params.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/params.cr"},{"filename":"core/primary_key.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/primary_key.cr"},{"filename":"core/query.cr","line_number":3,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query.cr"},{"filename":"core/validation.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/validation.cr"},{"filename":"core/schema/changes.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/schema/changes.cr"},{"filename":"core/schema/fields.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/schema/fields.cr"},{"filename":"core/schema/getters.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/schema/getters.cr"},{"filename":"core/schema/initializer.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/schema/initializer.cr"},{"filename":"core/schema/mapping.cr","line_number":3,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/schema/mapping.cr"},{"filename":"core/schema/references.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/schema/references.cr"},{"filename":"core/schema.cr","line_number":6,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/schema.cr"},{"filename":"core.cr","line_number":4,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core.cr"},{"filename":"core/converters/enum.cr","line_number":3,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converters/enum.cr"},{"filename":"core/converters/pg/numeric.cr","line_number":4,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converters/pg/numeric.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":"Meet `Core`, an expressive modular ORM for Crystal.","summary":"<p>Meet <code><a href=\"Core.html\">Core</a></code>, an expressive modular ORM for Crystal.</p>","class_methods":[{"id":"explicit_prepare_params(*params)-class-method","html_id":"explicit_prepare_params(*params)-class-method","name":"explicit_prepare_params","doc":"It's a small hack to deal with recursion. See below.\n:nodoc:","summary":"<p>It's a small hack to deal with recursion.</p>","abstract":false,"args":[{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(*params)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/params.cr#L28","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/params.cr#L28","def":{"name":"explicit_prepare_params","args":[{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":0,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"params.map do |p|\n  if p.is_a?(Enumerable)\n    p.map do |__arg1|\n      __arg1.as(Param)\n    end\n  else\n    p.as(Param)\n  end\nend"}},{"id":"prepare_params(*params)-class-method","html_id":"prepare_params(*params)-class-method","name":"prepare_params","doc":"Prepare *params* for database usage.\n\n```\nCore.prepare_params(42, \"foo\")\n# => {42, \"foo\"}\n\nCore.prepare_params([42, 43], \"foo\")\n# => {[42, 43], \"foo\"}\n```","summary":"<p>Prepare <em>params</em> for database usage.</p>","abstract":false,"args":[{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(*params)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/params.cr#L16","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/params.cr#L16","def":{"name":"prepare_params","args":[{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":0,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"params.map do |p|\n  if p.is_a?(Enumerable)\n    p.map do |__arg0|\n      __arg0.as(Param)\n    end\n  else\n    p.as(Param)\n  end\nend"}}],"constructors":[],"instance_methods":[],"macros":[{"id":"prepare_params(params)-macro","html_id":"prepare_params(params)-macro","name":"prepare_params","doc":"Prepare *params* from `Enumerable`.\n\n```\nCore.prepare_params([42, \"foo\"])\n# => {42, \"foo\"}\n```\n\nOPTIMIZE: Strictly type with (params : ArrayLiteral | SetLiteral)","summary":"<p>Prepare <em>params</em> from <code>Enumerable</code>.</p>","abstract":false,"args":[{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(params)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/params.cr#L46","def":{"name":"prepare_params","args":[{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":null,"block_arg":null,"visibility":"Public","body":"    \n{% if params.is_a?(ArrayLiteral) || params.is_a?(SetLiteral) %}\n      Core.prepare_params(\n        {% for e in params %}\n          {{ e }},\n        {% end %}\n      )\n    {% else %}\n      # Dirty! But macros aren't strictly typed yet\n      Core.explicit_prepare_params({{ params }})\n    {% end %}\n\n  \n"}}],"types":[{"html_id":"github.com/vladfaust/core/Core/Converter","path":"Core/Converter.html","kind":"class","full_name":"Core::Converter(T)","name":"Converter","abstract":true,"superclass":{"html_id":"github.com/vladfaust/core/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"github.com/vladfaust/core/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"github.com/vladfaust/core/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"core/converter.cr","line_number":7,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converter.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[{"html_id":"github.com/vladfaust/core/Core/Converters/Enum","kind":"class","full_name":"Core::Converters::Enum(EnumClass)","name":"Enum"},{"html_id":"github.com/vladfaust/core/Core/Converters/PG/Numeric","kind":"class","full_name":"Core::Converters::PG::Numeric","name":"Numeric"}],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core","kind":"module","full_name":"Core","name":"Core"},"doc":"Abstract class for `DB -> Model` converters.\n\nOPTIMIZE: Make class methods abstract. See https://stackoverflow.com/questions/41651107/crystal-abstract-static-method","summary":"<p>Abstract class for <code>DB -> Model</code> converters.</p>","class_methods":[{"id":"from_rs(rs):T-class-method","html_id":"from_rs(rs):T-class-method","name":"from_rs","doc":null,"summary":null,"abstract":false,"args":[{"name":"rs","doc":null,"default_value":"","external_name":"rs","restriction":""}],"args_string":"(rs) : T","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converter.cr#L8","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converter.cr#L8","def":{"name":"from_rs","args":[{"name":"rs","doc":null,"default_value":"","external_name":"rs","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"T","visibility":"Public","body":"raise(\"Not implemented!\")"}},{"id":"to_db(i:T):DB::Any-class-method","html_id":"to_db(i:T):DB::Any-class-method","name":"to_db","doc":null,"summary":null,"abstract":false,"args":[{"name":"i","doc":null,"default_value":"","external_name":"i","restriction":"T"}],"args_string":"(i : T) : DB::Any","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converter.cr#L12","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converter.cr#L12","def":{"name":"to_db","args":[{"name":"i","doc":null,"default_value":"","external_name":"i","restriction":"T"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"DB::Any","visibility":"Public","body":"raise(\"Not implemented!\")"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"github.com/vladfaust/core/Core/Converters","path":"Core/Converters.html","kind":"module","full_name":"Core::Converters","name":"Converters","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"core/converters/enum.cr","line_number":4,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converters/enum.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core","kind":"module","full_name":"Core","name":"Core"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"github.com/vladfaust/core/Core/Converters/Enum","path":"Core/Converters/Enum.html","kind":"class","full_name":"Core::Converters::Enum(EnumClass)","name":"Enum","abstract":false,"superclass":{"html_id":"github.com/vladfaust/core/Core/Converter","kind":"class","full_name":"Core::Converter","name":"Converter"},"ancestors":[{"html_id":"github.com/vladfaust/core/Core/Converter","kind":"class","full_name":"Core::Converter","name":"Converter"},{"html_id":"github.com/vladfaust/core/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"github.com/vladfaust/core/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"core/converters/enum.cr","line_number":30,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converters/enum.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core/Converters","kind":"module","full_name":"Core::Converters","name":"Converters"},"doc":"Allows to represent `SMALLINT`, `INT` or `BIGINT` values as Enums in models.\n\n```\n# SQL:\n# table users\n#   column role SMALLINT\n\nrequire \"core/converters/enum\"\n\nclass User\n  include Core::Schema\n\n  enum Role\n    JustAUser\n    Admin\n  end\n\n  schema do\n    field :role, Role, converter: Core::Converters::Enum(Role)\n  end\nend\n\nuser.role   # => User::Role::Admin\nuser.insert # => INSERT INTO users (role) VALUES(1)\n```","summary":"<p>Allows to represent <code>SMALLINT</code>, <code>INT</code> or <code>BIGINT</code> values as Enums in models.</p>","class_methods":[{"id":"from_rs(rs)-class-method","html_id":"from_rs(rs)-class-method","name":"from_rs","doc":null,"summary":null,"abstract":false,"args":[{"name":"rs","doc":null,"default_value":"","external_name":"rs","restriction":""}],"args_string":"(rs)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converters/enum.cr#L31","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converters/enum.cr#L31","def":{"name":"from_rs","args":[{"name":"rs","doc":null,"default_value":"","external_name":"rs","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"value = rs.read(Int32 | Nil)\nif value\n  EnumClass.new(value)\nend\n"}},{"id":"to_db(enum_enum:EnumClass)-class-method","html_id":"to_db(enum_enum:EnumClass)-class-method","name":"to_db","doc":null,"summary":null,"abstract":false,"args":[{"name":"_enum","doc":null,"default_value":"","external_name":"enum","restriction":"EnumClass"}],"args_string":"(enum _enum : EnumClass)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converters/enum.cr#L36","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converters/enum.cr#L36","def":{"name":"to_db","args":[{"name":"_enum","doc":null,"default_value":"","external_name":"enum","restriction":"EnumClass"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_enum.value"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"github.com/vladfaust/core/Core/Converters/PG","path":"Core/Converters/PG.html","kind":"module","full_name":"Core::Converters::PG","name":"PG","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"core/converters/pg/numeric.cr","line_number":5,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converters/pg/numeric.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core/Converters","kind":"module","full_name":"Core::Converters","name":"Converters"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"github.com/vladfaust/core/Core/Converters/PG/Numeric","path":"Core/Converters/PG/Numeric.html","kind":"class","full_name":"Core::Converters::PG::Numeric","name":"Numeric","abstract":false,"superclass":{"html_id":"github.com/vladfaust/core/Core/Converter","kind":"class","full_name":"Core::Converter","name":"Converter"},"ancestors":[{"html_id":"github.com/vladfaust/core/Core/Converter","kind":"class","full_name":"Core::Converter","name":"Converter"},{"html_id":"github.com/vladfaust/core/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"github.com/vladfaust/core/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"core/converters/pg/numeric.cr","line_number":27,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converters/pg/numeric.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core/Converters/PG","kind":"module","full_name":"Core::Converters::PG","name":"PG"},"doc":"Allows to represent `PG::Numeric` values as `Float64`s in models.\n\n```\n# SQL:\n# table users\n#   column balance NUMERIC(16, 8)\n\nrequire \"core/converters/pg/numeric\"\n\nclass User\n  include Core::Schema\n  include Core::Query\n\n  schema do\n    field :balance, Float64, converter: Core::Converters::PG::Numeric\n  end\nend\n\nuser = repository.query_one(User.last)\nuser.balance # => 42.0\n```","summary":"<p>Allows to represent <code><a href=\"../../../Core/Converters/PG/Numeric.html\">PG::Numeric</a></code> values as <code>Float64</code>s in models.</p>","class_methods":[{"id":"from_rs(rs)-class-method","html_id":"from_rs(rs)-class-method","name":"from_rs","doc":null,"summary":null,"abstract":false,"args":[{"name":"rs","doc":null,"default_value":"","external_name":"rs","restriction":""}],"args_string":"(rs)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converters/pg/numeric.cr#L28","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converters/pg/numeric.cr#L28","def":{"name":"from_rs","args":[{"name":"rs","doc":null,"default_value":"","external_name":"rs","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"(rs.read(::PG::Numeric | Nil)).try(&.to_f64)"}},{"id":"to_db(f:Float64)-class-method","html_id":"to_db(f:Float64)-class-method","name":"to_db","doc":null,"summary":null,"abstract":false,"args":[{"name":"f","doc":null,"default_value":"","external_name":"f","restriction":"Float64"}],"args_string":"(f : Float64)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converters/pg/numeric.cr#L32","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/converters/pg/numeric.cr#L32","def":{"name":"to_db","args":[{"name":"f","doc":null,"default_value":"","external_name":"f","restriction":"Float64"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"f"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[]}]}]},{"html_id":"github.com/vladfaust/core/Core/Logger","path":"Core/Logger.html","kind":"class","full_name":"Core::Logger","name":"Logger","abstract":true,"superclass":{"html_id":"github.com/vladfaust/core/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"github.com/vladfaust/core/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"github.com/vladfaust/core/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"core/logger.cr","line_number":2,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/logger.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[{"html_id":"github.com/vladfaust/core/Core/Logger/Dummy","kind":"class","full_name":"Core::Logger::Dummy","name":"Dummy"},{"html_id":"github.com/vladfaust/core/Core/Logger/IO","kind":"class","full_name":"Core::Logger::IO","name":"IO"},{"html_id":"github.com/vladfaust/core/Core/Logger/Standard","kind":"class","full_name":"Core::Logger::Standard","name":"Standard"}],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core","kind":"module","full_name":"Core","name":"Core"},"doc":"Logs stuff.","summary":"<p>Logs stuff.</p>","class_methods":[],"constructors":[],"instance_methods":[{"id":"wrap(query:String,&block:String->_)-instance-method","html_id":"wrap(query:String,&amp;block:String-&gt;_)-instance-method","name":"wrap","doc":null,"summary":null,"abstract":true,"args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"}],"args_string":"(query : String, &block : String -> _)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/logger.cr#L3","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/logger.cr#L3","def":{"name":"wrap","args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":1,"block_arg":{"name":"block","doc":null,"default_value":"","external_name":"block","restriction":"(String -> _)"},"return_type":"","visibility":"Public","body":""}}],"macros":[],"types":[{"html_id":"github.com/vladfaust/core/Core/Logger/Dummy","path":"Core/Logger/Dummy.html","kind":"class","full_name":"Core::Logger::Dummy","name":"Dummy","abstract":false,"superclass":{"html_id":"github.com/vladfaust/core/Core/Logger","kind":"class","full_name":"Core::Logger","name":"Logger"},"ancestors":[{"html_id":"github.com/vladfaust/core/Core/Logger","kind":"class","full_name":"Core::Logger","name":"Logger"},{"html_id":"github.com/vladfaust/core/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"github.com/vladfaust/core/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"core/logger/dummy.cr","line_number":4,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/logger/dummy.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core/Logger","kind":"class","full_name":"Core::Logger","name":"Logger"},"doc":"Does not log queries.","summary":"<p>Does not log queries.</p>","class_methods":[],"constructors":[],"instance_methods":[{"id":"wrap(query:String,&block:String->_)-instance-method","html_id":"wrap(query:String,&amp;block:String-&gt;_)-instance-method","name":"wrap","doc":null,"summary":null,"abstract":false,"args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"}],"args_string":"(query : String, &block : String -> _)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/logger/dummy.cr#L5","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/logger/dummy.cr#L5","def":{"name":"wrap","args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":1,"block_arg":{"name":"block","doc":null,"default_value":"","external_name":"block","restriction":"(String -> _)"},"return_type":"","visibility":"Public","body":"yield query"}}],"macros":[],"types":[]},{"html_id":"github.com/vladfaust/core/Core/Logger/IO","path":"Core/Logger/IO.html","kind":"class","full_name":"Core::Logger::IO","name":"IO","abstract":false,"superclass":{"html_id":"github.com/vladfaust/core/Core/Logger","kind":"class","full_name":"Core::Logger","name":"Logger"},"ancestors":[{"html_id":"github.com/vladfaust/core/Core/Logger","kind":"class","full_name":"Core::Logger","name":"Logger"},{"html_id":"github.com/vladfaust/core/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"github.com/vladfaust/core/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"core/logger/io.cr","line_number":7,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/logger/io.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core/Logger","kind":"class","full_name":"Core::Logger","name":"Logger"},"doc":"Logs queries into IO.","summary":"<p>Logs queries into IO.</p>","class_methods":[],"constructors":[{"id":"new(io:::IO)-class-method","html_id":"new(io:::IO)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"io","doc":null,"default_value":"","external_name":"io","restriction":"::IO"}],"args_string":"(io : ::IO)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/logger/io.cr#L8","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/logger/io.cr#L8","def":{"name":"new","args":[{"name":"io","doc":null,"default_value":"","external_name":"io","restriction":"::IO"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(io)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"wrap(query:String,&block:String->_)-instance-method","html_id":"wrap(query:String,&amp;block:String-&gt;_)-instance-method","name":"wrap","doc":"Wrap a query, logging elaped time.\n\n```\nwrap(\"SELECT * FROM users\") do |q|\n  db.query(q)\nend\n# => SELECT * FROM users\n# => 501μs\n```","summary":"<p>Wrap a query, logging elaped time.</p>","abstract":false,"args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"}],"args_string":"(query : String, &block : String -> _)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/logger/io.cr#L20","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/logger/io.cr#L20","def":{"name":"wrap","args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":1,"block_arg":{"name":"block","doc":null,"default_value":"","external_name":"block","restriction":"(String -> _)"},"return_type":"","visibility":"Public","body":"log_query(query)\nstarted_at = Time.monotonic\nr = yield query\nlog_time(Time.monotonic - started_at)\nr\n"}}],"macros":[],"types":[]},{"html_id":"github.com/vladfaust/core/Core/Logger/Standard","path":"Core/Logger/Standard.html","kind":"class","full_name":"Core::Logger::Standard","name":"Standard","abstract":false,"superclass":{"html_id":"github.com/vladfaust/core/Core/Logger","kind":"class","full_name":"Core::Logger","name":"Logger"},"ancestors":[{"html_id":"github.com/vladfaust/core/Core/Logger","kind":"class","full_name":"Core::Logger","name":"Logger"},{"html_id":"github.com/vladfaust/core/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"github.com/vladfaust/core/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"core/logger/standard.cr","line_number":7,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/logger/standard.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core/Logger","kind":"class","full_name":"Core::Logger","name":"Logger"},"doc":"Logs queries into standard `::Logger` at debug level.","summary":"<p>Logs queries into standard <code>::Logger</code> at debug level.</p>","class_methods":[],"constructors":[{"id":"new(logger:::Logger)-class-method","html_id":"new(logger:::Logger)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"logger","doc":null,"default_value":"","external_name":"logger","restriction":"::Logger"}],"args_string":"(logger : ::Logger)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/logger/standard.cr#L8","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/logger/standard.cr#L8","def":{"name":"new","args":[{"name":"logger","doc":null,"default_value":"","external_name":"logger","restriction":"::Logger"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(logger)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"wrap(query:String,&block:String->_)-instance-method","html_id":"wrap(query:String,&amp;block:String-&gt;_)-instance-method","name":"wrap","doc":"Wrap a query, logging elaped time at debug level.\n\n```\nwrap(\"SELECT * FROM users\") do |q|\n  db.query(q)\nend\n# [21:54:51:068] DEBUG > SELECT * FROM users\n# [21:54:51:068] DEBUG > 501μs\n```","summary":"<p>Wrap a query, logging elaped time at debug level.</p>","abstract":false,"args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"}],"args_string":"(query : String, &block : String -> _)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/logger/standard.cr#L20","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/logger/standard.cr#L20","def":{"name":"wrap","args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":1,"block_arg":{"name":"block","doc":null,"default_value":"","external_name":"block","restriction":"(String -> _)"},"return_type":"","visibility":"Public","body":"log_query(query)\nstarted_at = Time.monotonic\nr = yield query\nlog_time(Time.monotonic - started_at)\nr\n"}}],"macros":[],"types":[]}]},{"html_id":"github.com/vladfaust/core/Core/Param","path":"Core/Param.html","kind":"alias","full_name":"Core::Param","name":"Param","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"core/params.cr","line_number":2,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/params.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":true,"aliased":"(Array(Bool) | Array(Float32) | Array(Float64) | Array(Int32) | Array(Int64) | Array(String) | Array(Time) | Bool | Float32 | Float64 | Int32 | Int64 | Slice(UInt8) | String | Time | Nil)","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core","kind":"module","full_name":"Core","name":"Core"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"github.com/vladfaust/core/Core/PrimaryKey","path":"Core/PrimaryKey.html","kind":"alias","full_name":"Core::PrimaryKey","name":"PrimaryKey","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"core/primary_key.cr","line_number":2,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/primary_key.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":true,"aliased":"(Int32 | Int64 | Nil)","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core","kind":"module","full_name":"Core","name":"Core"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"github.com/vladfaust/core/Core/Query","path":"Core/Query.html","kind":"module","full_name":"Core::Query","name":"Query","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"core/query/instance/group_by.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/group_by.cr"},{"filename":"core/query/instance.cr","line_number":3,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr"},{"filename":"core/query.cr","line_number":29,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core","kind":"module","full_name":"Core","name":"Core"},"doc":"Include this module into your models:\n\n```\nclass User\n  include Core::Schema\n  include Core::Query\n\n  schema :users do\n    primary_key :id\n    field :name, String\n  end\nend\n\nrepo.query_one(User.where(id: 42))\n```\n\nOr use it separately (without module inclusion):\n\n```\nrepo.query_one(Core::Query.new(User).where(id: 42))\n# or\nrepo.query_one(Core::Query::Instance(User).new.where(id: 42))\n```\n\nIn both cases will return `Query::Instance` instances.","summary":"<p>Include this module into your models:</p>","class_methods":[],"constructors":[],"instance_methods":[],"macros":[{"id":"new(klass)-macro","html_id":"new(klass)-macro","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"klass","doc":null,"default_value":"","external_name":"klass","restriction":""}],"args_string":"(klass)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query.cr#L30","def":{"name":"new","args":[{"name":"klass","doc":null,"default_value":"","external_name":"klass","restriction":""}],"double_splat":null,"splat_index":null,"block_arg":null,"visibility":"Public","body":"      \n{{ @type }}\n::Instance(\n{{ klass }}\n).new\n    \n"}}],"types":[{"html_id":"github.com/vladfaust/core/Core/Query/Instance","path":"Core/Query/Instance.html","kind":"struct","full_name":"Core::Query::Instance(Schema)","name":"Instance","abstract":false,"superclass":{"html_id":"github.com/vladfaust/core/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"github.com/vladfaust/core/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"github.com/vladfaust/core/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"github.com/vladfaust/core/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"core/query/instance/group_by.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/group_by.cr"},{"filename":"core/query/instance/wherish.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/wherish.cr"},{"filename":"core/query/instance/having.cr","line_number":3,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr"},{"filename":"core/query/instance/join.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr"},{"filename":"core/query/instance/limit.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/limit.cr"},{"filename":"core/query/instance/offset.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/offset.cr"},{"filename":"core/query/instance/order_by.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/order_by.cr"},{"filename":"core/query/instance/select.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/select.cr"},{"filename":"core/query/instance/set.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/set.cr"},{"filename":"core/query/instance/where.cr","line_number":3,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr"},{"filename":"core/query/instance.cr","line_number":4,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core/Query","kind":"module","full_name":"Core::Query","name":"Query"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"id":"new-class-method","html_id":"new-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/group_by.cr#L1","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/group_by.cr#L1","def":{"name":"new","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"x = allocate\nif x.responds_to?(:finalize)\n  ::GC.add_finalizer(x)\nend\nx\n"}}],"instance_methods":[{"id":"all-instance-method","html_id":"all-instance-method","name":"all","doc":"Remove this query's `#limit` and return itself.\n\n```\nquery = Instance(User).new.limit(3).offset(5).all.to_s\n# => SELECT * FROM users OFFSET 5\n```","summary":"<p>Remove this query's <code><a href=\"../../Core/Query/Instance.html#limit%28limit%3AInt32%7CInt64%7CNil%29-instance-method\">#limit</a></code> and return itself.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L73","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L73","def":{"name":"all","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"limit(nil)\nself\n"}},{"id":"and-instance-method","html_id":"and-instance-method","name":"and","doc":"A shorthand for calling `and_where` or `and_having` depending on the last clause call.\n\n```\nquery.where(foo: \"bar\").and(baz: \"qux\")\n# => WHERE (foo = 'bar') AND (baz = 'qux')\nquery.having(foo: \"bar\").and(baz: \"qux\")\n# => HAVING (foo = 'bar') AND (baz = 'qux')\n```","summary":"<p>A shorthand for calling <code><a href=\"../../Core/Query/Instance.html#and_where-instance-method\">#and_where</a></code> or <code><a href=\"../../Core/Query/Instance.html#and_having-instance-method\">#and_having</a></code> depending on the last clause call.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/wherish.cr#L20","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/wherish.cr#L20","def":{"name":"and","args":[],"double_splat":{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"case @last_wherish_clause\nwhen :having\n  and_having(**args)\nelse\n  and_where(**args)\nend"}},{"id":"and_having-instance-method","html_id":"and_having-instance-method","name":"and_having","doc":"A convenient way to add `\"AND \"HAVING` clauses. Multiple clauses in a single call are joined with `AND`. See `#having` for examples.","summary":"<p>A convenient way to add <code>\"AND \"HAVING</code> clauses.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L138","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L138","def":{"name":"and_having","args":[],"double_splat":{"name":"having","doc":null,"default_value":"","external_name":"having","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"having(**having, or: false, not: false)"}},{"id":"and_having(clause,*params)-instance-method","html_id":"and_having(clause,*params)-instance-method","name":"and_having","doc":"Add `\"AND \"HAVING` clause.","summary":"<p>Add <code>\"AND \"HAVING</code> clause.</p>","abstract":false,"args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(clause, *params)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L138","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L138","def":{"name":"and_having","args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":1,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"having(clause, *params, or: false, not: false)"}},{"id":"and_not-instance-method","html_id":"and_not-instance-method","name":"and_not","doc":"A shorthand for calling `and_where\"_not\"` or `and_\"not_\"having` depending on the last clause call.\n\n```\nquery.where(foo: \"bar\").and\"_not\"(baz: \"qux\")\n# => WHERE (foo = 'bar') AND\" NOT\" (baz = 'qux')\nquery.having(foo: \"bar\").and\"_not\"(baz: \"qux\")\n# => HAVING (foo = 'bar') AND\" NOT\" (baz = 'qux')\n```","summary":"<p>A shorthand for calling <code>and_where\"_not\"</code> or <code>and_\"not_\"having</code> depending on the last clause call.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/wherish.cr#L20","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/wherish.cr#L20","def":{"name":"and_not","args":[],"double_splat":{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"case @last_wherish_clause\nwhen :having\n  and_not_having(**args)\nelse\n  and_where_not(**args)\nend"}},{"id":"and_not_having-instance-method","html_id":"and_not_having-instance-method","name":"and_not_having","doc":"A convenient way to add `\"AND \"\"NOT \"HAVING` clauses. Multiple clauses in a single call are joined with `AND`. See `#having` for examples.","summary":"<p>A convenient way to add <code>\"AND \"\"NOT \"HAVING</code> clauses.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L138","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L138","def":{"name":"and_not_having","args":[],"double_splat":{"name":"having","doc":null,"default_value":"","external_name":"having","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"having(**having, or: false, not: true)"}},{"id":"and_not_having(clause,*params)-instance-method","html_id":"and_not_having(clause,*params)-instance-method","name":"and_not_having","doc":"Add `\"AND \"\"NOT \"HAVING` clause.","summary":"<p>Add <code>\"AND \"\"NOT \"HAVING</code> clause.</p>","abstract":false,"args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(clause, *params)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L138","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L138","def":{"name":"and_not_having","args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":1,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"having(clause, *params, or: false, not: true)"}},{"id":"and_where-instance-method","html_id":"and_where-instance-method","name":"and_where","doc":"A convenient way to add `\"AND \"WHERE` clauses. Multiple clauses in a single call are joined with `AND`. See `#where` for examples.","summary":"<p>A convenient way to add <code>\"AND \"WHERE</code> clauses.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L138","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L138","def":{"name":"and_where","args":[],"double_splat":{"name":"where","doc":null,"default_value":"","external_name":"where","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"where(**where, or: false, not: false)"}},{"id":"and_where(clause,*params)-instance-method","html_id":"and_where(clause,*params)-instance-method","name":"and_where","doc":"Add `\"AND \"WHERE` clause.","summary":"<p>Add <code>\"AND \"WHERE</code> clause.</p>","abstract":false,"args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(clause, *params)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L138","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L138","def":{"name":"and_where","args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":1,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"where(clause, *params, or: false, not: false)"}},{"id":"and_where_not-instance-method","html_id":"and_where_not-instance-method","name":"and_where_not","doc":"A convenient way to add `\"AND \"\"NOT \"WHERE` clauses. Multiple clauses in a single call are joined with `AND`. See `#where` for examples.","summary":"<p>A convenient way to add <code>\"AND \"\"NOT \"WHERE</code> clauses.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L138","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L138","def":{"name":"and_where_not","args":[],"double_splat":{"name":"where","doc":null,"default_value":"","external_name":"where","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"where(**where, or: false, not: true)"}},{"id":"and_where_not(clause,*params)-instance-method","html_id":"and_where_not(clause,*params)-instance-method","name":"and_where_not","doc":"Add `\"AND \"\"NOT \"WHERE` clause.","summary":"<p>Add <code>\"AND \"\"NOT \"WHERE</code> clause.</p>","abstract":false,"args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(clause, *params)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L138","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L138","def":{"name":"and_where_not","args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":1,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"where(clause, *params, or: false, not: true)"}},{"id":"append_mapping_marker(mappable_type_name,_as,_select=&quot;*&quot;)-instance-method","html_id":"append_mapping_marker(mappable_type_name,_as,_select=&amp;quot;*&amp;quot;)-instance-method","name":"append_mapping_marker","doc":"Append SELECT marker used for mapping. E.g. `append_mapping_marker(\"post\")` would append \"SELECT '' AS _post, posts.*\"","summary":"<p>Append SELECT marker used for mapping.</p>","abstract":false,"args":[{"name":"mappable_type_name","doc":null,"default_value":"","external_name":"mappable_type_name","restriction":""},{"name":"_as","doc":null,"default_value":"","external_name":"_as","restriction":""},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"_select","restriction":""}],"args_string":"(mappable_type_name, _as, _select = <span class=\"s\">&quot;*&quot;</span>)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L119","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L119","def":{"name":"append_mapping_marker","args":[{"name":"mappable_type_name","doc":null,"default_value":"","external_name":"mappable_type_name","restriction":""},{"name":"_as","doc":null,"default_value":"","external_name":"_as","restriction":""},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"_select","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"if select_clauses.empty?\n  self.select(({{ Schema::TABLE.id.stringify }}) + \".*\")\nend\n_select = if _select.is_a?(Enumerable)\n  _select.map do |s|\n    \"#{_as}.#{s}\"\n  end.join(\", \")\nelse\n  \"#{_as}.#{_select}\"\nend\nself.select(\"'' AS _#{mappable_type_name}, #{_select}\")\n"}},{"id":"clone-instance-method","html_id":"clone-instance-method","name":"clone","doc":"TODO: Split to modules. Currently impossible due to https://github.com/crystal-lang/crystal/issues/5023","summary":"<p><span class=\"flag orange\">TODO</span>  Split to modules.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L35","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L35","def":{"name":"clone","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"clone = self.class.new\nclone.query_type = self.query_type\nclone.group_by_clauses = self.group_by_clauses.dup\nclone.having_clauses = self.having_clauses.clone\nclone.join_clauses = self.join_clauses.clone\nclone.limit_clause = self.limit_clause\nclone.offset_clause = self.offset_clause\nclone.order_by_clauses = self.order_by_clauses.dup\nclone.select_clauses = self.select_clauses.dup\nclone.where_clauses = self.where_clauses.clone\nreturn clone\n"}},{"id":"delete-instance-method","html_id":"delete-instance-method","name":"delete","doc":"Mark this query as a DELETE one","summary":"<p>Mark this query as a DELETE one</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L62","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L62","def":{"name":"delete","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@query_type = QueryType::Delete\nself\n"}},{"id":"first-instance-method","html_id":"first-instance-method","name":"first","doc":"Query the first row by `Model::Schema.primary_key[:name]`.\n\n```\nInstance(User).new.first.to_s\n# => SELECT * FROM users ORDER BY id ASC LIMIT 1\n```","summary":"<p>Query the first row by <code>Model::Schema.primary_key[:name]</code>.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L107","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L107","def":{"name":"first","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"order_by(Schema.primary_key[:name], :ASC)\none\nself\n"}},{"id":"full_join(reference,as_as=nil,select_select=&quot;*&quot;)-instance-method","html_id":"full_join(reference,as_as=nil,select_select=&amp;quot;*&amp;quot;)-instance-method","name":"full_join","doc":"`FULL JOIN` *reference*. See `#join`.","summary":"<p><code>FULL JOIN</code> <em>reference</em>.</p>","abstract":false,"args":[{"name":"reference","doc":null,"default_value":"","external_name":"reference","restriction":""},{"name":"_as","doc":null,"default_value":"nil","external_name":"as","restriction":""},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"select","restriction":""}],"args_string":"(reference, as _as = <span class=\"n\">nil</span>, select _select = <span class=\"s\">&quot;*&quot;</span>)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L157","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L157","def":{"name":"full_join","args":[{"name":"reference","doc":null,"default_value":"","external_name":"reference","restriction":""},{"name":"_as","doc":null,"default_value":"nil","external_name":"as","restriction":""},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"select","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"join(reference, _as, :full, _select)"}},{"id":"full_outer_join(reference,as_as=nil,select_select=&quot;*&quot;)-instance-method","html_id":"full_outer_join(reference,as_as=nil,select_select=&amp;quot;*&amp;quot;)-instance-method","name":"full_outer_join","doc":"`FULL OUTER JOIN` *reference*. See `#join`.","summary":"<p><code>FULL OUTER JOIN</code> <em>reference</em>.</p>","abstract":false,"args":[{"name":"reference","doc":null,"default_value":"","external_name":"reference","restriction":""},{"name":"_as","doc":null,"default_value":"nil","external_name":"as","restriction":""},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"select","restriction":""}],"args_string":"(reference, as _as = <span class=\"n\">nil</span>, select _select = <span class=\"s\">&quot;*&quot;</span>)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L157","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L157","def":{"name":"full_outer_join","args":[{"name":"reference","doc":null,"default_value":"","external_name":"reference","restriction":""},{"name":"_as","doc":null,"default_value":"nil","external_name":"as","restriction":""},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"select","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"join(reference, _as, :full_outer, _select)"}},{"id":"group_by(*group_by)-instance-method","html_id":"group_by(*group_by)-instance-method","name":"group_by","doc":"Append values to `GROUP_BY` clause.\n\n```\nCore::Query::Instance(User).new.group_by(\"users.id\").to_s\n# => SELECT users.* FROM users GROUP_BY users.id\n```","summary":"<p>Append values to <code>GROUP_BY</code> clause.</p>","abstract":false,"args":[{"name":"group_by","doc":null,"default_value":"","external_name":"group_by","restriction":""}],"args_string":"(*group_by)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/group_by.cr#L11","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/group_by.cr#L11","def":{"name":"group_by","args":[{"name":"group_by","doc":null,"default_value":"","external_name":"group_by","restriction":""}],"double_splat":null,"splat_index":0,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@group_by_clauses.concat(group_by.to_a.flatten.map(&.to_s))\nself\n"}},{"id":"having(clause:String,params:Array|Tuple|Nil=nil,or=false,not=false)-instance-method","html_id":"having(clause:String,params:Array|Tuple|Nil=nil,or=false,not=false)-instance-method","name":"having","doc":"Add a `HAVING` *clause*, optionally interpolated with *params*. Multiple calls will join clauses with `AND`.\n\n```\nquery.having(\"char_length(name) > ?\", [10]).and_not_having(\"created_at > NOW()\").to_s\n# => HAVING (char_length(name) > ?) AND NOT (created_at > NOW())\n```","summary":"<p>Add a <code>HAVING</code> <em>clause</em>, optionally interpolated with <em>params</em>.</p>","abstract":false,"args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":"String"},{"name":"params","doc":null,"default_value":"nil","external_name":"params","restriction":"Array | Tuple | Nil"},{"name":"or","doc":null,"default_value":"false","external_name":"or","restriction":""},{"name":"not","doc":null,"default_value":"false","external_name":"not","restriction":""}],"args_string":"(clause : String, params : Array | Tuple | Nil = <span class=\"n\">nil</span>, or = <span class=\"n\">false</span>, not = <span class=\"n\">false</span>)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L17","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L17","def":{"name":"having","args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":"String"},{"name":"params","doc":null,"default_value":"nil","external_name":"params","restriction":"Array | Tuple | Nil"},{"name":"or","doc":null,"default_value":"false","external_name":"or","restriction":""},{"name":"not","doc":null,"default_value":"false","external_name":"not","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@having_clauses << HavingTuple.new(clause: clause, params: params.try do |__arg0|\n  __arg0.to_a.map do |__arg1|\n    __arg1.as(Param)\n  end\nend, or: or, not: not)\n@last_wherish_clause = :having\nself\n"}},{"id":"having(or=false,not=false,**having)-instance-method","html_id":"having(or=false,not=false,**having)-instance-method","name":"having","doc":"A convenient way to add `HAVING` clauses. Multiple clauses in a single call are joined with `AND`. Examples:\n\n```\nuser = User.new(id: 42)\nquery = Core::Query::Instance(Post).new\n\n# All clauses below will result in\n# \"HAVING (posts.author_id = ?)\"\n# with params [42]\nquery.having(author: user)\nquery.having(author_id: user.id)\nquery.having(\"posts.author_id = ?\", user.id)\n\n# Will result in\n# \"HAVING (posts.author_id IN (?, ?) AND posts.popular = ?)\"\n# with params [1, 2, true]\nquery.having(author_id: [1, 2], popular: true)\n\n# Will result in\n# \"HAVING NOT ((posts.author_id = ? AND posts.editor_id IS NULL))\"\n# with params [42]\nquery.not_having(author: user, editor: nil)\n\n# Will result in\n# \"HAVING (posts.author_id = ?) OR NOT (posts.editor_id IS NOT NULL)\"\n# with params [42]\nquery.having(author: user).or_not_having(editor: !nil)\n\n# Will result in\n# \"HAVING (users.role = ?)\"\n# with params [1]\nUser.having(role: User::Role::Admin)\n```","summary":"<p>A convenient way to add <code>HAVING</code> clauses.</p>","abstract":false,"args":[{"name":"or","doc":null,"default_value":"false","external_name":"or","restriction":""},{"name":"not","doc":null,"default_value":"false","external_name":"not","restriction":""}],"args_string":"(or = <span class=\"n\">false</span>, not = <span class=\"n\">false</span>, **having)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L56","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L56","def":{"name":"having","args":[{"name":"or","doc":null,"default_value":"false","external_name":"or","restriction":""},{"name":"not","doc":null,"default_value":"false","external_name":"not","restriction":""}],"double_splat":{"name":"having","doc":null,"default_value":"","external_name":"having","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"group = [] of InternalHavingTuple\nhaving.to_h.tap(&.each do |key, value|\n  {% if true %}\n        case key\n        {% for field in Schema::INTERNAL__CORE_FIELDS %}\n          when {{ field[:key] }}\n            column = Schema.table + \".\" + {{ field[:key].id.stringify }}\n\n            if value.nil?\n              next group << InternalHavingTuple.new(\n                clause: column + \" IS NULL\",\n                params: nil,\n              )\n            elsif value.is_a?(Enumerable)\n              next group << InternalHavingTuple.new(\n                clause: column + \" IN (\" + value.size.times.map { \"?\" }.join(\", \") + \")\",\n                params: value.map{ |v| field_to_db({{ field }}, v) },\n              )\n            {% if field[:type] == \"Bool\" %}{% else %}\n              elsif value == true\n                next group << InternalHavingTuple.new(\n                  clause: column + \" IS NOT NULL\",\n                  params: nil,\n                )\n            {% end %}\n            else\n              next group << InternalHavingTuple.new(\n                clause: column + \" = ?\",\n                params: Array(Param){field_to_db({{ field }}, value)},\n              )\n            end\n        {% end %}\n\n        {% for reference in Schema::INTERNAL__CORE_REFERENCES %}\n          when {{ reference[:name] }}\n            column = {{ (Schema::TABLE.id.stringify + \".\") + reference[:key].id.stringify }}\n\n            if value.nil?\n              next group << InternalHavingTuple.new(\n                clause: column + \" IS NULL\",\n                params: nil,\n              )\n            elsif value == true\n              next group << InternalHavingTuple.new(\n                clause: column + \" IS NOT NULL\",\n                params: nil,\n              )\n            elsif value.is_a?({{ reference[:type] }})\n              next group << InternalHavingTuple.new(\n                clause: column + \" = ?\",\n                params: [value.primary_key.as(Param)],\n              )\n            elsif value.is_a?(Enumerable({{ reference[:type] }}))\n              next group << InternalHavingTuple.new(\n                clause: column + \" IN (\" + value.size.times.map { \"?\" }.join(\", \") + \")\",\n                params: value.map &.primary_key.as(Param),\n              )\n            else\n              raise ArgumentError.new(\"#{key} value must be either nil, true, {{ reference[:class].id }} or Enumerable({{ reference[:class].id }})! Given: #{value.class}\")\n            end\n        {% end %}\n        else\n          raise ArgumentError.new(\"The key must be either reference or a field! Given: #{key}\")\n        end\n      {% end %}\nend)\nhaving(group.map(&.[](:clause)).join(\" AND \"), group.map(&.[](:params)).flatten, or: or, not: not)\n"}},{"id":"inner_join(reference,as_as=nil,select_select=&quot;*&quot;)-instance-method","html_id":"inner_join(reference,as_as=nil,select_select=&amp;quot;*&amp;quot;)-instance-method","name":"inner_join","doc":"`INNER JOIN` *reference*. See `#join`.","summary":"<p><code>INNER JOIN</code> <em>reference</em>.</p>","abstract":false,"args":[{"name":"reference","doc":null,"default_value":"","external_name":"reference","restriction":""},{"name":"_as","doc":null,"default_value":"nil","external_name":"as","restriction":""},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"select","restriction":""}],"args_string":"(reference, as _as = <span class=\"n\">nil</span>, select _select = <span class=\"s\">&quot;*&quot;</span>)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L153","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L153","def":{"name":"inner_join","args":[{"name":"reference","doc":null,"default_value":"","external_name":"reference","restriction":""},{"name":"_as","doc":null,"default_value":"nil","external_name":"as","restriction":""},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"select","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"join(reference, _as, :inner, _select)"}},{"id":"join(reference:Symbol,as_as:Symbol?=nil,type_type:Symbol?=nil,select_select:JoinSelectType=&quot;*&quot;)-instance-method","html_id":"join(reference:Symbol,as_as:Symbol?=nil,type_type:Symbol?=nil,select_select:JoinSelectType=&amp;quot;*&amp;quot;)-instance-method","name":"join","doc":"`JOIN` *reference* - leverages schema's references' potential.\n\n- *reference* means **what** to join;\n- *as* defines alias. Default to *reference*;\n- *type* declares a joining type (e.g. :left_outer);\n- *select* specifies which fields to select (`nil` for none, `*` by default).\n\n```\nclass User\n  include Core::Schema\n  include Core::Query\n\n  schema :users do\n    primary_key :id\n    reference :authored_posts, Array(Post), foreign_key: :author_id\n    reference :edited_posts, Array(Post), foreign_key: :editor_id\n  end\nend\n\nclass Post\n  include Core::Schema\n  include Core::Query\n\n  schema :users do\n    primary_key :id\n    reference :author, User, key: :author_id\n    reference :editor, User, key: :editor_id\n  end\nend\n\nPost.join(:author, select: :id).to_s\n# => SELECT posts.*, '' AS _author, author.id FROM posts JOIN users AS author ON author.id = posts.author_id\n\nPost.join(:author, select: nil).where(\"author.id = ?\", [1]).to_s\n# => SELECT posts.* FROM posts JOIN users AS author ON author.id = posts.author_id WHERE author.id = ?\n\nUser.join(:authored_posts, as: :written_posts).to_s\n# => SELECT posts.*, '' as _post, written_posts.* FROM users JOIN posts AS written_posts ON users.id = written_posts.author_id\n\nPost.right_outer_join(:editor).to_s                    # Equal\nQuery.new(Post).join(:editor, type: :right_outer).to_s # Equal\n# => SELECT posts.*, '' as _user, editor.* FROM posts RIGHT OUTER JOIN users AS editor ON editor.id = posts.editor_id\n```","summary":"<p><code>JOIN</code> <em>reference</em> - leverages schema's references' potential.</p>","abstract":false,"args":[{"name":"reference","doc":null,"default_value":"","external_name":"reference","restriction":"Symbol"},{"name":"_as","doc":null,"default_value":"nil","external_name":"as","restriction":"Symbol | ::Nil"},{"name":"_type","doc":null,"default_value":"nil","external_name":"type","restriction":"Symbol | ::Nil"},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"select","restriction":"JoinSelectType"}],"args_string":"(reference : Symbol, as _as : Symbol? = <span class=\"n\">nil</span>, type _type : Symbol? = <span class=\"n\">nil</span>, select _select : JoinSelectType = <span class=\"s\">&quot;*&quot;</span>)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L84","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L84","def":{"name":"join","args":[{"name":"reference","doc":null,"default_value":"","external_name":"reference","restriction":"Symbol"},{"name":"_as","doc":null,"default_value":"nil","external_name":"as","restriction":"Symbol | ::Nil"},{"name":"_type","doc":null,"default_value":"nil","external_name":"type","restriction":"Symbol | ::Nil"},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"select","restriction":"JoinSelectType"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"{% if true %}\n      case reference\n        {% for reference in Schema::INTERNAL__CORE_REFERENCES %}\n          when {{ reference[:name] }}\n            on = {% if reference[:key] %}\n              {{ reference[:key] }}\n            {% else %}{% if reference[:foreign_key] %}\n              Schema.primary_key[:name]\n            {% else %}\n              {% raise(\"Reference must have either foreign_key or key\") %}\n            {% end %}{% end %}\n\n            if _select\n              _mapped_select = map_select_to_field_keys({{ reference[:type] }}, _select)\n              append_mapping_marker({{ reference[:name] }}, _as || {{ reference[:name] }}, _mapped_select)\n            end\n\n            join(\n              table: {{ reference[:type] }}.table,\n              on: {\n                {{ reference[:foreign_key] }},\n                \"#{Schema.table}.#{on}\",\n              },\n              as: _as || {{ reference[:name] }},\n              type: _type\n            )\n        {% end %}\n        else\n          raise \"Unknown reference #{reference} for #{Schema}\"\n        end\n    {% end %}"}},{"id":"join(table:Symbol|String,on:Tuple(Symbol|String,Symbol|String),as_as:Symbol|String?=nil,type_type:Symbol?=nil,select_select:JoinSelectType=&quot;*&quot;)-instance-method","html_id":"join(table:Symbol|String,on:Tuple(Symbol|String,Symbol|String),as_as:Symbol|String?=nil,type_type:Symbol?=nil,select_select:JoinSelectType=&amp;quot;*&amp;quot;)-instance-method","name":"join","doc":"Verbose `JOIN` by *table*. Selects all joined columns by default.\n\n```\nUser.join(:posts, on: {:author_id, :id}, as: :written_posts).to_s\n# => SELECT users.* FROM users JOIN posts AS written_posts ON written_posts.author_id = users.id\n```","summary":"<p>Verbose <code>JOIN</code> by <em>table</em>.</p>","abstract":false,"args":[{"name":"table","doc":null,"default_value":"","external_name":"table","restriction":"Symbol | String"},{"name":"on","doc":null,"default_value":"","external_name":"on","restriction":"Tuple(Symbol | String, Symbol | String)"},{"name":"_as","doc":null,"default_value":"nil","external_name":"as","restriction":"Symbol | String | ::Nil"},{"name":"_type","doc":null,"default_value":"nil","external_name":"type","restriction":"Symbol | ::Nil"},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"select","restriction":"JoinSelectType"}],"args_string":"(table : Symbol | String, on : Tuple(Symbol | String, Symbol | String), as _as : Symbol | String? = <span class=\"n\">nil</span>, type _type : Symbol? = <span class=\"n\">nil</span>, select _select : JoinSelectType = <span class=\"s\">&quot;*&quot;</span>)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L23","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L23","def":{"name":"join","args":[{"name":"table","doc":null,"default_value":"","external_name":"table","restriction":"Symbol | String"},{"name":"on","doc":null,"default_value":"","external_name":"on","restriction":"Tuple(Symbol | String, Symbol | String)"},{"name":"_as","doc":null,"default_value":"nil","external_name":"as","restriction":"Symbol | String | ::Nil"},{"name":"_type","doc":null,"default_value":"nil","external_name":"type","restriction":"Symbol | ::Nil"},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"select","restriction":"JoinSelectType"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@join_clauses.push(JoinTuple.new(table: table.to_s, on: on.map(&.to_s), as: _as.try(&.to_s) || table.to_s, type: _type, select: _select.is_a?(Enumerable) ? _select.map(&.to_s) : _select.to_s))\nself\n"}},{"id":"last-instance-method","html_id":"last-instance-method","name":"last","doc":"Query the last row by `Model::Schema.primary_key[:name]`.\n\n```\nInstance(User).new.last.to_s\n# => SELECT * FROM users ORDER BY id DESC LIMIT 1\n```","summary":"<p>Query the last row by <code>Model::Schema.primary_key[:name]</code>.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L95","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L95","def":{"name":"last","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"order_by(Schema.primary_key[:name], :DESC)\none\nself\n"}},{"id":"left_join(reference,as_as=nil,select_select=&quot;*&quot;)-instance-method","html_id":"left_join(reference,as_as=nil,select_select=&amp;quot;*&amp;quot;)-instance-method","name":"left_join","doc":"`LEFT JOIN` *reference*. See `#join`.","summary":"<p><code>LEFT JOIN</code> <em>reference</em>.</p>","abstract":false,"args":[{"name":"reference","doc":null,"default_value":"","external_name":"reference","restriction":""},{"name":"_as","doc":null,"default_value":"nil","external_name":"as","restriction":""},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"select","restriction":""}],"args_string":"(reference, as _as = <span class=\"n\">nil</span>, select _select = <span class=\"s\">&quot;*&quot;</span>)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L157","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L157","def":{"name":"left_join","args":[{"name":"reference","doc":null,"default_value":"","external_name":"reference","restriction":""},{"name":"_as","doc":null,"default_value":"nil","external_name":"as","restriction":""},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"select","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"join(reference, _as, :left, _select)"}},{"id":"left_outer_join(reference,as_as=nil,select_select=&quot;*&quot;)-instance-method","html_id":"left_outer_join(reference,as_as=nil,select_select=&amp;quot;*&amp;quot;)-instance-method","name":"left_outer_join","doc":"`LEFT OUTER JOIN` *reference*. See `#join`.","summary":"<p><code>LEFT OUTER JOIN</code> <em>reference</em>.</p>","abstract":false,"args":[{"name":"reference","doc":null,"default_value":"","external_name":"reference","restriction":""},{"name":"_as","doc":null,"default_value":"nil","external_name":"as","restriction":""},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"select","restriction":""}],"args_string":"(reference, as _as = <span class=\"n\">nil</span>, select _select = <span class=\"s\">&quot;*&quot;</span>)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L157","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L157","def":{"name":"left_outer_join","args":[{"name":"reference","doc":null,"default_value":"","external_name":"reference","restriction":""},{"name":"_as","doc":null,"default_value":"nil","external_name":"as","restriction":""},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"select","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"join(reference, _as, :left_outer, _select)"}},{"id":"limit(limit:Int32|Int64|Nil)-instance-method","html_id":"limit(limit:Int32|Int64|Nil)-instance-method","name":"limit","doc":"Set `LIMIT` clause.\n\n```\nCore::Query::Instance(User).new.limit(50).to_s\n# => SELECT users.* FROM users LIMIT 50\n```","summary":"<p>Set <code>LIMIT</code> clause.</p>","abstract":false,"args":[{"name":"limit","doc":null,"default_value":"","external_name":"limit","restriction":"Int32 | Int64 | Nil"}],"args_string":"(limit : Int32 | Int64 | Nil)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/limit.cr#L11","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/limit.cr#L11","def":{"name":"limit","args":[{"name":"limit","doc":null,"default_value":"","external_name":"limit","restriction":"Int32 | Int64 | Nil"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@limit_clause = limit\nself\n"}},{"id":"not_having(clause,*params)-instance-method","html_id":"not_having(clause,*params)-instance-method","name":"not_having","doc":"Add `HAVING NOT` clause.","summary":"<p>Add <code>HAVING NOT</code> clause.</p>","abstract":false,"args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(clause, *params)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L129","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L129","def":{"name":"not_having","args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":1,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"having(clause, *params, not: true)"}},{"id":"not_having-instance-method","html_id":"not_having-instance-method","name":"not_having","doc":"Add `HAVING NOT` clause.","summary":"<p>Add <code>HAVING NOT</code> clause.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L134","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L134","def":{"name":"not_having","args":[],"double_splat":{"name":"having","doc":null,"default_value":"","external_name":"having","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"having(**having, not: true)"}},{"id":"offset(offset:Int32|Int64|Nil)-instance-method","html_id":"offset(offset:Int32|Int64|Nil)-instance-method","name":"offset","doc":"Set `OFFSET` clause.\n\n```\nCore::Query::Instance(User).new.offset(5).to_s\n# => SELECT users.* FROM users OFFSET 5\n```","summary":"<p>Set <code>OFFSET</code> clause.</p>","abstract":false,"args":[{"name":"offset","doc":null,"default_value":"","external_name":"offset","restriction":"Int32 | Int64 | Nil"}],"args_string":"(offset : Int32 | Int64 | Nil)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/offset.cr#L11","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/offset.cr#L11","def":{"name":"offset","args":[{"name":"offset","doc":null,"default_value":"","external_name":"offset","restriction":"Int32 | Int64 | Nil"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@offset_clause = offset\nself\n"}},{"id":"one-instance-method","html_id":"one-instance-method","name":"one","doc":"Sets this query limit to 1.\n\n```\nquery = Instance(User).new.one.to_s\n# => SELECT * FROM users LIMIT 1\n```","summary":"<p>Sets this query limit to 1.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L84","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L84","def":{"name":"one","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"limit(1)\nself\n"}},{"id":"or-instance-method","html_id":"or-instance-method","name":"or","doc":"A shorthand for calling `or_where` or `or_having` depending on the last clause call.\n\n```\nquery.where(foo: \"bar\").or(baz: \"qux\")\n# => WHERE (foo = 'bar') OR (baz = 'qux')\nquery.having(foo: \"bar\").or(baz: \"qux\")\n# => HAVING (foo = 'bar') OR (baz = 'qux')\n```","summary":"<p>A shorthand for calling <code><a href=\"../../Core/Query/Instance.html#or_where-instance-method\">#or_where</a></code> or <code><a href=\"../../Core/Query/Instance.html#or_having-instance-method\">#or_having</a></code> depending on the last clause call.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/wherish.cr#L20","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/wherish.cr#L20","def":{"name":"or","args":[],"double_splat":{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"case @last_wherish_clause\nwhen :having\n  or_having(**args)\nelse\n  or_where(**args)\nend"}},{"id":"or_having(clause,*params)-instance-method","html_id":"or_having(clause,*params)-instance-method","name":"or_having","doc":"Add `\"OR \"HAVING` clause.","summary":"<p>Add <code>\"OR \"HAVING</code> clause.</p>","abstract":false,"args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(clause, *params)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L138","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L138","def":{"name":"or_having","args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":1,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"having(clause, *params, or: true, not: false)"}},{"id":"or_having-instance-method","html_id":"or_having-instance-method","name":"or_having","doc":"A convenient way to add `\"OR \"HAVING` clauses. Multiple clauses in a single call are joined with `AND`. See `#having` for examples.","summary":"<p>A convenient way to add <code>\"OR \"HAVING</code> clauses.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L138","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L138","def":{"name":"or_having","args":[],"double_splat":{"name":"having","doc":null,"default_value":"","external_name":"having","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"having(**having, or: true, not: false)"}},{"id":"or_not-instance-method","html_id":"or_not-instance-method","name":"or_not","doc":"A shorthand for calling `or_where\"_not\"` or `or_\"not_\"having` depending on the last clause call.\n\n```\nquery.where(foo: \"bar\").or\"_not\"(baz: \"qux\")\n# => WHERE (foo = 'bar') OR\" NOT\" (baz = 'qux')\nquery.having(foo: \"bar\").or\"_not\"(baz: \"qux\")\n# => HAVING (foo = 'bar') OR\" NOT\" (baz = 'qux')\n```","summary":"<p>A shorthand for calling <code>or_where\"_not\"</code> or <code>or_\"not_\"having</code> depending on the last clause call.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/wherish.cr#L20","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/wherish.cr#L20","def":{"name":"or_not","args":[],"double_splat":{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"case @last_wherish_clause\nwhen :having\n  or_not_having(**args)\nelse\n  or_where_not(**args)\nend"}},{"id":"or_not_having(clause,*params)-instance-method","html_id":"or_not_having(clause,*params)-instance-method","name":"or_not_having","doc":"Add `\"OR \"\"NOT \"HAVING` clause.","summary":"<p>Add <code>\"OR \"\"NOT \"HAVING</code> clause.</p>","abstract":false,"args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(clause, *params)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L138","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L138","def":{"name":"or_not_having","args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":1,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"having(clause, *params, or: true, not: true)"}},{"id":"or_not_having-instance-method","html_id":"or_not_having-instance-method","name":"or_not_having","doc":"A convenient way to add `\"OR \"\"NOT \"HAVING` clauses. Multiple clauses in a single call are joined with `AND`. See `#having` for examples.","summary":"<p>A convenient way to add <code>\"OR \"\"NOT \"HAVING</code> clauses.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L138","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr#L138","def":{"name":"or_not_having","args":[],"double_splat":{"name":"having","doc":null,"default_value":"","external_name":"having","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"having(**having, or: true, not: true)"}},{"id":"or_where-instance-method","html_id":"or_where-instance-method","name":"or_where","doc":"A convenient way to add `\"OR \"WHERE` clauses. Multiple clauses in a single call are joined with `AND`. See `#where` for examples.","summary":"<p>A convenient way to add <code>\"OR \"WHERE</code> clauses.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L138","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L138","def":{"name":"or_where","args":[],"double_splat":{"name":"where","doc":null,"default_value":"","external_name":"where","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"where(**where, or: true, not: false)"}},{"id":"or_where(clause,*params)-instance-method","html_id":"or_where(clause,*params)-instance-method","name":"or_where","doc":"Add `\"OR \"WHERE` clause.","summary":"<p>Add <code>\"OR \"WHERE</code> clause.</p>","abstract":false,"args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(clause, *params)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L138","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L138","def":{"name":"or_where","args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":1,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"where(clause, *params, or: true, not: false)"}},{"id":"or_where_not(clause,*params)-instance-method","html_id":"or_where_not(clause,*params)-instance-method","name":"or_where_not","doc":"Add `\"OR \"\"NOT \"WHERE` clause.","summary":"<p>Add <code>\"OR \"\"NOT \"WHERE</code> clause.</p>","abstract":false,"args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(clause, *params)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L138","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L138","def":{"name":"or_where_not","args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":1,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"where(clause, *params, or: true, not: true)"}},{"id":"or_where_not-instance-method","html_id":"or_where_not-instance-method","name":"or_where_not","doc":"A convenient way to add `\"OR \"\"NOT \"WHERE` clauses. Multiple clauses in a single call are joined with `AND`. See `#where` for examples.","summary":"<p>A convenient way to add <code>\"OR \"\"NOT \"WHERE</code> clauses.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L138","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L138","def":{"name":"or_where_not","args":[],"double_splat":{"name":"where","doc":null,"default_value":"","external_name":"where","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"where(**where, or: true, not: true)"}},{"id":"order_by(column:Symbol|String,order:Symbol|String|Nil=nil)-instance-method","html_id":"order_by(column:Symbol|String,order:Symbol|String|Nil=nil)-instance-method","name":"order_by","doc":"Add `ORDER BY` clause. Only `Symbol`s are accepted.\n\n```\nCore::Query::Instance.new(User).order_by(\"name\", :DESC).to_s\n# => SELECT users.* FROM users ORDER BY name DESC\n```","summary":"<p>Add <code>ORDER BY</code> clause.</p>","abstract":false,"args":[{"name":"column","doc":null,"default_value":"","external_name":"column","restriction":"Symbol | String"},{"name":"order","doc":null,"default_value":"nil","external_name":"order","restriction":"Symbol | String | Nil"}],"args_string":"(column : Symbol | String, order : Symbol | String | Nil = <span class=\"n\">nil</span>)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/order_by.cr#L14","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/order_by.cr#L14","def":{"name":"order_by","args":[{"name":"column","doc":null,"default_value":"","external_name":"column","restriction":"Symbol | String"},{"name":"order","doc":null,"default_value":"nil","external_name":"order","restriction":"Symbol | String | Nil"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"if column.is_a?(Symbol)\n  {% if true %}\n        case column\n        {% for field in Schema::INTERNAL__CORE_FIELDS %}\n          when {{ field[:name] }}\n            column = {{ field[:key].id.stringify }}\n        {% end %}\n        else\n          raise ArgumentError.new(\"Invalid field name #{column} for #{Schema}!\")\n        end\n      {% end %}\nend\n@order_by_clauses.push(OrderByTuple.new(column: column, order: order.try do |__arg0|\n  __arg0.to_s.upcase\nend))\nself\n"}},{"id":"params-instance-method","html_id":"params-instance-method","name":"params","doc":"A list of params for this query.","summary":"<p>A list of params for this query.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L6","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L6","def":{"name":"params","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@params"}},{"id":"query_type-instance-method","html_id":"query_type-instance-method","name":"query_type","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L15","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L15","def":{"name":"query_type","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@query_type"}},{"id":"reset-instance-method","html_id":"reset-instance-method","name":"reset","doc":"Reset all the values to defaults.\n\nTODO: Split to modules. Currently impossible due to https://github.com/crystal-lang/crystal/issues/5023","summary":"<p>Reset all the values to defaults.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L21","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L21","def":{"name":"reset","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"params.clear\ngroup_by_clauses.clear\nhaving_clauses.clear\njoin_clauses.clear\n@limit_clause = nil\n@offset_clause = nil\norder_by_clauses.clear\nselect_clauses.clear\nwhere_clauses.clear\nself\n"}},{"id":"right_join(reference,as_as=nil,select_select=&quot;*&quot;)-instance-method","html_id":"right_join(reference,as_as=nil,select_select=&amp;quot;*&amp;quot;)-instance-method","name":"right_join","doc":"`RIGHT JOIN` *reference*. See `#join`.","summary":"<p><code>RIGHT JOIN</code> <em>reference</em>.</p>","abstract":false,"args":[{"name":"reference","doc":null,"default_value":"","external_name":"reference","restriction":""},{"name":"_as","doc":null,"default_value":"nil","external_name":"as","restriction":""},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"select","restriction":""}],"args_string":"(reference, as _as = <span class=\"n\">nil</span>, select _select = <span class=\"s\">&quot;*&quot;</span>)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L157","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L157","def":{"name":"right_join","args":[{"name":"reference","doc":null,"default_value":"","external_name":"reference","restriction":""},{"name":"_as","doc":null,"default_value":"nil","external_name":"as","restriction":""},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"select","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"join(reference, _as, :right, _select)"}},{"id":"right_outer_join(reference,as_as=nil,select_select=&quot;*&quot;)-instance-method","html_id":"right_outer_join(reference,as_as=nil,select_select=&amp;quot;*&amp;quot;)-instance-method","name":"right_outer_join","doc":"`RIGHT OUTER JOIN` *reference*. See `#join`.","summary":"<p><code>RIGHT OUTER JOIN</code> <em>reference</em>.</p>","abstract":false,"args":[{"name":"reference","doc":null,"default_value":"","external_name":"reference","restriction":""},{"name":"_as","doc":null,"default_value":"nil","external_name":"as","restriction":""},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"select","restriction":""}],"args_string":"(reference, as _as = <span class=\"n\">nil</span>, select _select = <span class=\"s\">&quot;*&quot;</span>)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L157","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L157","def":{"name":"right_outer_join","args":[{"name":"reference","doc":null,"default_value":"","external_name":"reference","restriction":""},{"name":"_as","doc":null,"default_value":"nil","external_name":"as","restriction":""},{"name":"_select","doc":null,"default_value":"\"*\"","external_name":"select","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"join(reference, _as, :right_outer, _select)"}},{"id":"select(*values)-instance-method","html_id":"select(*values)-instance-method","name":"select","doc":"  schema :users do\n    primary_key :id\n    field :foo, String\n    field :bar, String, key: :baz\n  end\nend\n\nCore::Query::Instance(User).new.select(\"name\").to_s\n# => SELECT name FROM users\n\nUser.select(\"DISTINCT name\").select(:foo, :bar).to_s\n# => SELECT DISTINCT name, foo, baz FROM users\n\nUser.select(:id).select(\"*\")\n# => SELECT id, * FROM users\n```","summary":"<p>schema :users do     primary_key :id     field :foo, String     field :bar, String, key: :baz   end end</p>","abstract":false,"args":[{"name":"values","doc":null,"default_value":"","external_name":"values","restriction":""}],"args_string":"(*values)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/select.cr#L28","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/select.cr#L28","def":{"name":"select","args":[{"name":"values","doc":null,"default_value":"","external_name":"values","restriction":""}],"double_splat":null,"splat_index":0,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"values.to_a.each do |value|\n  if value.is_a?(String)\n    select_clauses << value\n  else\n    if value.is_a?(Symbol)\n      {% if true %}\n          case value\n          {% for field in Schema::INTERNAL__CORE_FIELDS %}\n            when {{ field[:name] }}\n              select_clauses << {{ field[:key].id.stringify }}\n          {% end %}\n          else\n            raise ArgumentError.new(\"Invalid field name #{value} for #{Schema}!\")\n          end\n        {% end %}\n    else\n      raise(ArgumentError.new(\"A value to select must be either String or Symbol! Given: #{value.class}\"))\n    end\n  end\nend\nself\n"}},{"id":"select-instance-method","html_id":"select-instance-method","name":"select","doc":"Mark this query as a SELECT one (default)","summary":"<p>Mark this query as a SELECT one (default)</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L50","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L50","def":{"name":"select","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@query_type = QueryType::Select\nself\n"}},{"id":"set-instance-method","html_id":"set-instance-method","name":"set","doc":"Append values to `SET` clauses, setting Query type to `UPDATE`.\n\nNOTE: It's not included in `Query` module to avoid confusion about possible `Schema#set` method. Use `Query#update` beforeahead.\n\n```\nUser.update.set(active: true).to_s                     # Equal\nCore::Query::Instance(User).new.set(active: true).to_s # Equal\n# => UPDATE users SET active = true\n```","summary":"<p>Append values to <code>SET</code> clauses, setting Query type to <code>UPDATE</code>.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/set.cr#L31","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/set.cr#L31","def":{"name":"set","args":[],"double_splat":{"name":"values","doc":null,"default_value":"","external_name":"values","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"values.to_h.each do |key, value|\n  {% if true %}\n        case key\n        {% for field in Schema::INTERNAL__CORE_FIELDS %}\n          when {{ field[:name] }}\n            set({{ field[:key].id.stringify }} + \" = ?\", value)\n        {% end %}\n        else\n          raise ArgumentError.new(\"Invalid field name #{key} for #{Schema}!\")\n        end\n      {% end %}\nend\nself\n"}},{"id":"set(clause,*params)-instance-method","html_id":"set(clause,*params)-instance-method","name":"set","doc":"Append explicit value to `SET` clauses, setting Query type to `UPDATE`.\n\n```\nCore::Query::Instance(User).new.update.set(\"popularity = floor(random() * ?)\", 100).to_s\n# => UPDATE users SET popularity = floor(random() * ?) with params [100]\n```","summary":"<p>Append explicit value to <code>SET</code> clauses, setting Query type to <code>UPDATE</code>.</p>","abstract":false,"args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(clause, *params)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/set.cr#L11","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/set.cr#L11","def":{"name":"set","args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":1,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"update\nset_clauses << SetTuple.new(clause: clause, params: params.try do |__arg0|\n  __arg0.to_a.map do |__arg1|\n    __arg1.as(Param)\n  end\nend)\nself\n"}},{"id":"to_s-instance-method","html_id":"to_s-instance-method","name":"to_s","doc":"Build the query, returning its SQL representation.\n\nNOTE: `#params` are empty until built.","summary":"<p>Build the query, returning its SQL representation.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L116","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L116","def":{"name":"to_s","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"params.clear\nquery = \"\"\ncase query_type\nwhen QueryType::Select\n  append_select_clauses\n  query = query + (\" FROM \" + Schema.table)\nwhen QueryType::Update\n  query = query + (\"UPDATE \" + Schema.table)\n  append_set_clauses\nwhen QueryType::Delete\n  query = query + (\"DELETE FROM \" + Schema.table)\nend\nappend_join_clauses\nappend_where_clauses\nappend_group_by_clauses\nappend_having_clauses\nappend_order_by_clauses\nappend_limit_clause\nappend_offset_clause\nquery.strip\n"}},{"id":"update-instance-method","html_id":"update-instance-method","name":"update","doc":"Mark this query as an UPDATE one","summary":"<p>Mark this query as an UPDATE one</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L56","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L56","def":{"name":"update","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@query_type = QueryType::Update\nself\n"}},{"id":"where(or=false,not=false,**where)-instance-method","html_id":"where(or=false,not=false,**where)-instance-method","name":"where","doc":"A convenient way to add `WHERE` clauses. Multiple clauses in a single call are joined with `AND`. Examples:\n\n```\nuser = User.new(id: 42)\nquery = Core::Query::Instance(Post).new\n\n# All clauses below will result in\n# \"WHERE (posts.author_id = ?)\"\n# with params [42]\nquery.where(author: user)\nquery.where(author_id: user.id)\nquery.where(\"posts.author_id = ?\", user.id)\n\n# Will result in\n# \"WHERE (posts.author_id IN (?, ?) AND posts.popular = ?)\"\n# with params [1, 2, true]\nquery.where(author_id: [1, 2], popular: true)\n\n# Will result in\n# \"WHERE NOT ((posts.author_id = ? AND posts.editor_id IS NULL))\"\n# with params [42]\nquery.not_where(author: user, editor: nil)\n\n# Will result in\n# \"WHERE (posts.author_id = ?) OR NOT (posts.editor_id IS NOT NULL)\"\n# with params [42]\nquery.where(author: user).or_not_where(editor: !nil)\n\n# Will result in\n# \"WHERE (users.role = ?)\"\n# with params [1]\nUser.where(role: User::Role::Admin)\n```","summary":"<p>A convenient way to add <code>WHERE</code> clauses.</p>","abstract":false,"args":[{"name":"or","doc":null,"default_value":"false","external_name":"or","restriction":""},{"name":"not","doc":null,"default_value":"false","external_name":"not","restriction":""}],"args_string":"(or = <span class=\"n\">false</span>, not = <span class=\"n\">false</span>, **where)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L56","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L56","def":{"name":"where","args":[{"name":"or","doc":null,"default_value":"false","external_name":"or","restriction":""},{"name":"not","doc":null,"default_value":"false","external_name":"not","restriction":""}],"double_splat":{"name":"where","doc":null,"default_value":"","external_name":"where","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"group = [] of InternalWhereTuple\nwhere.to_h.tap(&.each do |key, value|\n  {% if true %}\n        case key\n        {% for field in Schema::INTERNAL__CORE_FIELDS %}\n          when {{ field[:key] }}\n            column = Schema.table + \".\" + {{ field[:key].id.stringify }}\n\n            if value.nil?\n              next group << InternalWhereTuple.new(\n                clause: column + \" IS NULL\",\n                params: nil,\n              )\n            elsif value.is_a?(Enumerable)\n              next group << InternalWhereTuple.new(\n                clause: column + \" IN (\" + value.size.times.map { \"?\" }.join(\", \") + \")\",\n                params: value.map{ |v| field_to_db({{ field }}, v) },\n              )\n            {% if field[:type] == \"Bool\" %}{% else %}\n              elsif value == true\n                next group << InternalWhereTuple.new(\n                  clause: column + \" IS NOT NULL\",\n                  params: nil,\n                )\n            {% end %}\n            else\n              next group << InternalWhereTuple.new(\n                clause: column + \" = ?\",\n                params: Array(Param){field_to_db({{ field }}, value)},\n              )\n            end\n        {% end %}\n\n        {% for reference in Schema::INTERNAL__CORE_REFERENCES %}\n          when {{ reference[:name] }}\n            column = {{ (Schema::TABLE.id.stringify + \".\") + reference[:key].id.stringify }}\n\n            if value.nil?\n              next group << InternalWhereTuple.new(\n                clause: column + \" IS NULL\",\n                params: nil,\n              )\n            elsif value == true\n              next group << InternalWhereTuple.new(\n                clause: column + \" IS NOT NULL\",\n                params: nil,\n              )\n            elsif value.is_a?({{ reference[:type] }})\n              next group << InternalWhereTuple.new(\n                clause: column + \" = ?\",\n                params: [value.primary_key.as(Param)],\n              )\n            elsif value.is_a?(Enumerable({{ reference[:type] }}))\n              next group << InternalWhereTuple.new(\n                clause: column + \" IN (\" + value.size.times.map { \"?\" }.join(\", \") + \")\",\n                params: value.map &.primary_key.as(Param),\n              )\n            else\n              raise ArgumentError.new(\"#{key} value must be either nil, true, {{ reference[:class].id }} or Enumerable({{ reference[:class].id }})! Given: #{value.class}\")\n            end\n        {% end %}\n        else\n          raise ArgumentError.new(\"The key must be either reference or a field! Given: #{key}\")\n        end\n      {% end %}\nend)\nwhere(group.map(&.[](:clause)).join(\" AND \"), group.map(&.[](:params)).flatten, or: or, not: not)\n"}},{"id":"where(clause:String,params:Array|Tuple|Nil=nil,or=false,not=false)-instance-method","html_id":"where(clause:String,params:Array|Tuple|Nil=nil,or=false,not=false)-instance-method","name":"where","doc":"Add a `WHERE` *clause*, optionally interpolated with *params*. Multiple calls will join clauses with `AND`.\n\n```\nquery.where(\"char_length(name) > ?\", [10]).and_not_where(\"created_at > NOW()\").to_s\n# => WHERE (char_length(name) > ?) AND NOT (created_at > NOW())\n```","summary":"<p>Add a <code>WHERE</code> <em>clause</em>, optionally interpolated with <em>params</em>.</p>","abstract":false,"args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":"String"},{"name":"params","doc":null,"default_value":"nil","external_name":"params","restriction":"Array | Tuple | Nil"},{"name":"or","doc":null,"default_value":"false","external_name":"or","restriction":""},{"name":"not","doc":null,"default_value":"false","external_name":"not","restriction":""}],"args_string":"(clause : String, params : Array | Tuple | Nil = <span class=\"n\">nil</span>, or = <span class=\"n\">false</span>, not = <span class=\"n\">false</span>)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L17","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L17","def":{"name":"where","args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":"String"},{"name":"params","doc":null,"default_value":"nil","external_name":"params","restriction":"Array | Tuple | Nil"},{"name":"or","doc":null,"default_value":"false","external_name":"or","restriction":""},{"name":"not","doc":null,"default_value":"false","external_name":"not","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@where_clauses << WhereTuple.new(clause: clause, params: params.try do |__arg0|\n  __arg0.to_a.map do |__arg1|\n    __arg1.as(Param)\n  end\nend, or: or, not: not)\n@last_wherish_clause = :where\nself\n"}},{"id":"where_not-instance-method","html_id":"where_not-instance-method","name":"where_not","doc":"Add `WHERE NOT` clause.","summary":"<p>Add <code>WHERE NOT</code> clause.</p>","abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L134","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L134","def":{"name":"where_not","args":[],"double_splat":{"name":"where","doc":null,"default_value":"","external_name":"where","restriction":""},"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"where(**where, not: true)"}},{"id":"where_not(clause,*params)-instance-method","html_id":"where_not(clause,*params)-instance-method","name":"where_not","doc":"Add `WHERE NOT` clause.","summary":"<p>Add <code>WHERE NOT</code> clause.</p>","abstract":false,"args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(clause, *params)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L129","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr#L129","def":{"name":"where_not","args":[{"name":"clause","doc":null,"default_value":"","external_name":"clause","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":1,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"where(clause, *params, not: true)"}}],"macros":[{"id":"field_to_db(field,value)-macro","html_id":"field_to_db(field,value)-macro","name":"field_to_db","doc":null,"summary":null,"abstract":false,"args":[{"name":"field","doc":null,"default_value":"","external_name":"field","restriction":""},{"name":"value","doc":null,"default_value":"","external_name":"value","restriction":""}],"args_string":"(field, value)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/wherish.cr#L2","def":{"name":"field_to_db","args":[{"name":"field","doc":null,"default_value":"","external_name":"field","restriction":""},{"name":"value","doc":null,"default_value":"","external_name":"value","restriction":""}],"double_splat":null,"splat_index":null,"block_arg":null,"visibility":"Public","body":"    \n{% if field[:converter] %}\n      if {{ value }}.is_a?({{ field[:type] }})\n        {{ field[:converter].id }}.to_db({{ value }}).as(Param)\n      else\n        raise ArgumentError.new(\"Invalid value #{{{ value }}.class} passed to {{ field[:converter].id }}\")\n      end\n    {% else %}\n      if {{ value }}.is_a?(Param)\n        {{ value }}.as(Param)\n      else\n        raise ArgumentError.new(\"Invalid value class #{{{ value }}.class} for field {{ field[:name] }}\")\n      end\n    {% end %}\n\n  \n"}},{"id":"map_select_to_field_keys(reference_type,selects)-macro","html_id":"map_select_to_field_keys(reference_type,selects)-macro","name":"map_select_to_field_keys","doc":null,"summary":null,"abstract":false,"args":[{"name":"reference_type","doc":null,"default_value":"","external_name":"reference_type","restriction":""},{"name":"selects","doc":null,"default_value":"","external_name":"selects","restriction":""}],"args_string":"(reference_type, selects)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/join.cr#L133","def":{"name":"map_select_to_field_keys","args":[{"name":"reference_type","doc":null,"default_value":"","external_name":"reference_type","restriction":""},{"name":"selects","doc":null,"default_value":"","external_name":"selects","restriction":""}],"double_splat":null,"splat_index":null,"block_arg":null,"visibility":"Public","body":"    if \n{{ selects }}\n == \"*\" || \n{{ selects }}\n == :*\n      \"*\"\n    \nelse\n      column_selects = Set(String).new\n      \n{% for field in reference_type.resolve.constant(\"INTERNAL__CORE_FIELDS\") %}\n        if ({{ selects }}.is_a?(Enumerable) && ({{ selects }}.includes?({{ field[:name] }}) || ({{ selects }}.includes?({{ field[:name].id.stringify }})))) || ({{ selects }}.to_s == {{ field[:name].id.stringify }})\n          column_selects.add({{ field[:key].id.stringify }})\n        end\n      {% end %}\n\n      column_selects.to_a\n    \nend\n  \n"}}],"types":[{"html_id":"github.com/vladfaust/core/Core/Query/Instance/InternalHavingTuple","path":"Core/Query/Instance/InternalHavingTuple.html","kind":"alias","full_name":"Core::Query::Instance::InternalHavingTuple","name":"InternalHavingTuple","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"core/query/instance/having.cr","line_number":6,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/having.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":true,"aliased":"NamedTuple(clause: String, params: Array(Array(Bool) | Array(Float32) | Array(Float64) | Array(Int32) | Array(Int64) | Array(String) | Array(Time) | Bool | Float32 | Float64 | Int32 | Int64 | Slice(UInt8) | String | Time | Nil) | Nil)","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core/Query/Instance","kind":"struct","full_name":"Core::Query::Instance(Schema)","name":"Instance"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"github.com/vladfaust/core/Core/Query/Instance/InternalWhereTuple","path":"Core/Query/Instance/InternalWhereTuple.html","kind":"alias","full_name":"Core::Query::Instance::InternalWhereTuple","name":"InternalWhereTuple","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"core/query/instance/where.cr","line_number":6,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance/where.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":true,"aliased":"NamedTuple(clause: String, params: Array(Array(Bool) | Array(Float32) | Array(Float64) | Array(Int32) | Array(Int64) | Array(String) | Array(Time) | Bool | Float32 | Float64 | Int32 | Int64 | Slice(UInt8) | String | Time | Nil) | Nil)","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core/Query/Instance","kind":"struct","full_name":"Core::Query::Instance(Schema)","name":"Instance"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"github.com/vladfaust/core/Core/Query/Instance/QueryType","path":"Core/Query/Instance/QueryType.html","kind":"enum","full_name":"Core::Query::Instance::QueryType","name":"QueryType","abstract":false,"superclass":null,"ancestors":[{"html_id":"github.com/vladfaust/core/Enum","kind":"struct","full_name":"Enum","name":"Enum"},{"html_id":"github.com/vladfaust/core/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"github.com/vladfaust/core/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"github.com/vladfaust/core/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"core/query/instance.cr","line_number":9,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":true,"alias":false,"aliased":"","const":false,"constants":[{"id":"Select","name":"Select","value":"0","doc":null,"summary":null},{"id":"Update","name":"Update","value":"1","doc":null,"summary":null},{"id":"Delete","name":"Delete","value":"2","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core/Query/Instance","kind":"struct","full_name":"Core::Query::Instance(Schema)","name":"Instance"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"delete?-instance-method","html_id":"delete?-instance-method","name":"delete?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L12","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L12","def":{"name":"delete?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"self == Delete"}},{"id":"select?-instance-method","html_id":"select?-instance-method","name":"select?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L10","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L10","def":{"name":"select?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"self == Select"}},{"id":"update?-instance-method","html_id":"update?-instance-method","name":"update?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L11","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/query/instance.cr#L11","def":{"name":"update?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"self == Update"}}],"macros":[],"types":[]}]}]},{"html_id":"github.com/vladfaust/core/Core/Repository","path":"Core/Repository.html","kind":"class","full_name":"Core::Repository","name":"Repository","abstract":false,"superclass":{"html_id":"github.com/vladfaust/core/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"github.com/vladfaust/core/Core/Repository/Scalar","kind":"module","full_name":"Core::Repository::Scalar","name":"Scalar"},{"html_id":"github.com/vladfaust/core/Core/Repository/Exec","kind":"module","full_name":"Core::Repository::Exec","name":"Exec"},{"html_id":"github.com/vladfaust/core/Core/Repository/Delete","kind":"module","full_name":"Core::Repository::Delete","name":"Delete"},{"html_id":"github.com/vladfaust/core/Core/Repository/Update","kind":"module","full_name":"Core::Repository::Update","name":"Update"},{"html_id":"github.com/vladfaust/core/Core/Repository/Insert","kind":"module","full_name":"Core::Repository::Insert","name":"Insert"},{"html_id":"github.com/vladfaust/core/Core/Repository/Query","kind":"module","full_name":"Core::Repository::Query","name":"Query"},{"html_id":"github.com/vladfaust/core/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"github.com/vladfaust/core/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"core/repository/delete.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/delete.cr"},{"filename":"core/repository/exec.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/exec.cr"},{"filename":"core/repository/insert.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/insert.cr"},{"filename":"core/repository/query.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr"},{"filename":"core/repository/scalar.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/scalar.cr"},{"filename":"core/repository/update.cr","line_number":1,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/update.cr"},{"filename":"core/repository.cr","line_number":44,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[{"html_id":"github.com/vladfaust/core/Core/Repository/Delete","kind":"module","full_name":"Core::Repository::Delete","name":"Delete"},{"html_id":"github.com/vladfaust/core/Core/Repository/Exec","kind":"module","full_name":"Core::Repository::Exec","name":"Exec"},{"html_id":"github.com/vladfaust/core/Core/Repository/Insert","kind":"module","full_name":"Core::Repository::Insert","name":"Insert"},{"html_id":"github.com/vladfaust/core/Core/Repository/Query","kind":"module","full_name":"Core::Repository::Query","name":"Query"},{"html_id":"github.com/vladfaust/core/Core/Repository/Scalar","kind":"module","full_name":"Core::Repository::Scalar","name":"Scalar"},{"html_id":"github.com/vladfaust/core/Core/Repository/Update","kind":"module","full_name":"Core::Repository::Update","name":"Update"}],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core","kind":"module","full_name":"Core","name":"Core"},"doc":"`Repository` is a gateway between `Model`s and Database.\n\nSupported methods:\n\n- `#query` (alias of `#query_all`)\n- `#query_one`\n- `#query_one?`\n- `#insert`\n- `#update`\n- `#delete`\n- `#exec`\n- `#scalar`\n\nSee `Query` for a handy queries builder.\n\n```\nlogger = Core::Logger::IO.new(STDOUT)\nrepo = Core::Repository.new(db, logger)\n\nuser = User.new(name: \"Foo\")\nuser = repo.insert(user)\n# INSERT INTO users (name, created_at) VALUES ($1, $2) RETURNING *\n# 1.773ms\n\nquery = User.last\nuser = repo.query_one(query)\n# SELECT * FROM users ORDER BY id DESC LIMIT 1\n# 275μs\n\nuser.name = \"Bar\"\nrepo.update(user)\n# UPDATE users SET name = $1 WHERE (id = $2) RETURNING *\n# 1.578ms\n\nrepo.delete(user)\n# DELETE FROM users WHERE id = $1\n# 1.628ms\n```","summary":"<p><code><a href=\"../Core/Repository.html\">Repository</a></code> is a gateway between <code>Model</code>s and Database.</p>","class_methods":[],"constructors":[{"id":"new(db:DB::Database,query_logger:Core::Logger=Core::Logger::Dummy.new)-class-method","html_id":"new(db:DB::Database,query_logger:Core::Logger=Core::Logger::Dummy.new)-class-method","name":"new","doc":"Initialize a new `Repository` istance linked to *db*,\nwhich is data storage, and *query_logger*,\nwhich logs Database queries.\n\nNOTE: *db* and *query_logger* can be changed in the runtime with according `#db=` and `#query_logger=` methods.","summary":"<p>Initialize a new <code><a href=\"../Core/Repository.html\">Repository</a></code> istance linked to <em>db</em>, which is data storage, and <em>query_logger</em>, which logs Database queries.</p>","abstract":false,"args":[{"name":"db","doc":null,"default_value":"","external_name":"db","restriction":"::DB::Database"},{"name":"query_logger","doc":null,"default_value":"Core::Logger::Dummy.new","external_name":"query_logger","restriction":"Core::Logger"}],"args_string":"(db : DB::Database, query_logger : Core::Logger = <span class=\"t\">Core</span><span class=\"t\">::</span><span class=\"t\">Logger</span><span class=\"t\">::</span><span class=\"t\">Dummy</span>.<span class=\"k\">new</span>)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository.cr#L62","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository.cr#L62","def":{"name":"new","args":[{"name":"db","doc":null,"default_value":"","external_name":"db","restriction":"::DB::Database"},{"name":"query_logger","doc":null,"default_value":"Core::Logger::Dummy.new","external_name":"query_logger","restriction":"Core::Logger"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(db, query_logger)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"prepare_query(query:String):String-instance-method","html_id":"prepare_query(query:String):String-instance-method","name":"prepare_query","doc":"Prepare *query* for execution. Replaces \"?\" with \"$i\" for PostgreSQL.","summary":"<p>Prepare <em>query</em> for execution.</p>","abstract":false,"args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"}],"args_string":"(query : String) : String","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository.cr#L66","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository.cr#L66","def":{"name":"prepare_query","args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"if db.driver.is_a?(PG::Driver)\n  counter = 0\n  query = (query.as(String)).gsub(\"?\") do\n    \"$\" + (counter = counter + 1).to_s\n  end\nend\nquery\n"}}],"macros":[],"types":[{"html_id":"github.com/vladfaust/core/Core/Repository/Delete","path":"Core/Repository/Delete.html","kind":"module","full_name":"Core::Repository::Delete","name":"Delete","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"core/repository/delete.cr","line_number":2,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/delete.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[{"html_id":"github.com/vladfaust/core/Core/Repository","kind":"class","full_name":"Core::Repository","name":"Repository"}],"namespace":{"html_id":"github.com/vladfaust/core/Core/Repository","kind":"class","full_name":"Core::Repository","name":"Repository"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"delete(query:Core::Query::Instance(T))forallT-instance-method","html_id":"delete(query:Core::Query::Instance(T))forallT-instance-method","name":"delete","doc":"Issue a deletion query. Basically the same as `#exec` just calling `query.delete` before.\n\n```\nrepo.delete(User.where(id: 1))\n# Equals to\nrepo.exec(User.delete.where(id: 1))\n```","summary":"<p>Issue a deletion query.</p>","abstract":false,"args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"Core::Query::Instance(T)"}],"args_string":"(query : Core::Query::Instance(T)) forall T","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/delete.cr#L10","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/delete.cr#L10","def":{"name":"delete","args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"Core::Query::Instance(T)"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"query.delete\nexec(query.to_s, query.params)\n"}},{"id":"delete(instance:Schema)-instance-method","html_id":"delete(instance:Schema)-instance-method","name":"delete","doc":"Delete a single *instance* from Database.\nReturns `DB::ExecResult`.\n\nTODO: Handle errors.","summary":"<p>Delete a single <em>instance</em> from Database.</p>","abstract":false,"args":[{"name":"instance","doc":null,"default_value":"","external_name":"instance","restriction":"Schema"}],"args_string":"(instance : Schema)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/delete.cr#L23","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/delete.cr#L23","def":{"name":"delete","args":[{"name":"instance","doc":null,"default_value":"","external_name":"instance","restriction":"Schema"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"delete([instance])"}},{"id":"delete(instances:Array(Schema))-instance-method","html_id":"delete(instances:Array(Schema))-instance-method","name":"delete","doc":"Delete multiple *instances* from Database.\nReturns `DB::ExecResult`.\n\nTODO: Handle errors.","summary":"<p>Delete multiple <em>instances</em> from Database.</p>","abstract":false,"args":[{"name":"instances","doc":null,"default_value":"","external_name":"instances","restriction":"Array(Schema)"}],"args_string":"(instances : Array(Schema))","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/delete.cr#L31","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/delete.cr#L31","def":{"name":"delete","args":[{"name":"instances","doc":null,"default_value":"","external_name":"instances","restriction":"Array(Schema)"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"if instances.empty?\n  raise(ArgumentError.new(\"Empty array given\"))\nend\nclasses = instances.map(&.class).to_set\nif classes.size > 1\n  raise(ArgumentError.new(\"Instances must be of single type, given: #{classes.join(\", \")}\"))\nend\nklass = instances[0].class\nquery = SQL_DELETE % {table_name: klass.table, primary_key: klass.primary_key[:name], primary_key_values: instances.map do\n  '?'\nend.join(\", \")}\nexec(query, instances.map(&.primary_key))\n"}}],"macros":[],"types":[]},{"html_id":"github.com/vladfaust/core/Core/Repository/Exec","path":"Core/Repository/Exec.html","kind":"module","full_name":"Core::Repository::Exec","name":"Exec","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"core/repository/exec.cr","line_number":2,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/exec.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[{"html_id":"github.com/vladfaust/core/Core/Repository","kind":"class","full_name":"Core::Repository","name":"Repository"}],"namespace":{"html_id":"github.com/vladfaust/core/Core/Repository","kind":"class","full_name":"Core::Repository","name":"Repository"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"exec(query:Core::Query::Instance(T))forallT-instance-method","html_id":"exec(query:Core::Query::Instance(T))forallT-instance-method","name":"exec","doc":"Execute *query* (after stringifying and extracting params) and return a `DB::ExecResult`.","summary":"<p>Execute <em>query</em> (after stringifying and extracting params) and return a <code>DB::ExecResult</code>.</p>","abstract":false,"args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"Core::Query::Instance(T)"}],"args_string":"(query : Core::Query::Instance(T)) forall T","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/exec.cr#L20","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/exec.cr#L20","def":{"name":"exec","args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"Core::Query::Instance(T)"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"exec(query.to_s, query.params)"}},{"id":"exec(query:String,*params)-instance-method","html_id":"exec(query:String,*params)-instance-method","name":"exec","doc":"Execute *query* and return a `DB::ExecResult`.\n\nSee http://crystal-lang.github.io/crystal-db/api/0.5.0/DB/QueryMethods.html#exec%28query%2C%2Aargs%29-instance-method\n\n```\nrepo.exec(\"UPDATE foo SET now = NOW()\")\n```","summary":"<p>Execute <em>query</em> and return a <code>DB::ExecResult</code>.</p>","abstract":false,"args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(query : String, *params)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/exec.cr#L10","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/exec.cr#L10","def":{"name":"exec","args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":1,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"query = prepare_query(query)\nif params.any?\n  params = Core.prepare_params(*params)\nend\nquery_logger.wrap(query) do\n  db.exec(query, *params)\nend\n"}}],"macros":[],"types":[]},{"html_id":"github.com/vladfaust/core/Core/Repository/Insert","path":"Core/Repository/Insert.html","kind":"module","full_name":"Core::Repository::Insert","name":"Insert","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"core/repository/insert.cr","line_number":2,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/insert.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[{"html_id":"github.com/vladfaust/core/Core/Repository","kind":"class","full_name":"Core::Repository","name":"Repository"}],"namespace":{"html_id":"github.com/vladfaust/core/Core/Repository","kind":"class","full_name":"Core::Repository","name":"Repository"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"insert(instance:Schema)-instance-method","html_id":"insert(instance:Schema)-instance-method","name":"insert","doc":"Insert a single *instance* into Database. Returns `DB::ExecResult`.\n\nTODO: Handle errors.\nTODO: [RFC] Call `#query` and return `Schema` instance instead (see https://github.com/will/crystal-pg/issues/101).","summary":"<p>Insert a single <em>instance</em> into Database.</p>","abstract":false,"args":[{"name":"instance","doc":null,"default_value":"","external_name":"instance","restriction":"Schema"}],"args_string":"(instance : Schema)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/insert.cr#L11","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/insert.cr#L11","def":{"name":"insert","args":[{"name":"instance","doc":null,"default_value":"","external_name":"instance","restriction":"Schema"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"(insert([instance])).first"}},{"id":"insert(instances:Array(Schema))-instance-method","html_id":"insert(instances:Array(Schema))-instance-method","name":"insert","doc":"Insert multiple *instances* into Database. Returns `DB::ExecResult`.\n\nTODO: Handle errors.\nTODO: [RFC] Call `#query` and return `Schema` instance instead (see https://github.com/will/crystal-pg/issues/101).","summary":"<p>Insert multiple <em>instances</em> into Database.</p>","abstract":false,"args":[{"name":"instances","doc":null,"default_value":"","external_name":"instances","restriction":"Array(Schema)"}],"args_string":"(instances : Array(Schema))","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/insert.cr#L19","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/insert.cr#L19","def":{"name":"insert","args":[{"name":"instances","doc":null,"default_value":"","external_name":"instances","restriction":"Array(Schema)"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"if instances.empty?\n  raise(ArgumentError.new(\"Empty array given\"))\nend\nclasses = instances.map(&.class).to_set\nif classes.size > 1\n  raise(ArgumentError.new(\"Instances must be of single type, given: #{classes.join(\", \")}\"))\nend\nklass = instances[0].class\ninstances_fields = instances.map do |__arg1|\n  __arg1.fields.dup.tap do |f|\n    f.each do |k, _|\n      if f[k].nil? && klass.fields[k][:db_default]\n        next f.delete(k)\n      end\n      if k == klass.primary_key[:name]\n        next f.delete(k)\n      end\n    end\n  end\nend\ninserted_columns = instances_fields[0].keys.map do |f|\n  klass.fields[f][:key]\nend\nquery = SQL_INSERT % {table_name: klass.table, keys: inserted_columns.join(\", \"), values: instances_fields.map do |fields|\n  (\"(\" + (fields.values.map do |f|\n    f == default ? default : \"?\"\n  end.join(\", \"))) + \")\"\nend.join(\", \")}\nparams = instances_fields.first.values\ninstances_fields[1..-1].each do |fields|\n  params = params + fields.values\nend\nquery(klass, query, params)\n"}}],"macros":[],"types":[]},{"html_id":"github.com/vladfaust/core/Core/Repository/Query","path":"Core/Repository/Query.html","kind":"module","full_name":"Core::Repository::Query","name":"Query","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"core/repository/query.cr","line_number":2,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[{"html_id":"github.com/vladfaust/core/Core/Repository","kind":"class","full_name":"Core::Repository","name":"Repository"}],"namespace":{"html_id":"github.com/vladfaust/core/Core/Repository","kind":"class","full_name":"Core::Repository","name":"Repository"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"query(query:Core::Query::Instance(T))forallT-instance-method","html_id":"query(query:Core::Query::Instance(T))forallT-instance-method","name":"query","doc":"Query `#db` returning an array of model instances inherited from *query*.\n\n```\nrepo.query(User.all) # => Array(User)\n```\n\nTODO: Handle errors (PQ::PQError)","summary":"<p>Query <code>#db</code> returning an array of model instances inherited from <em>query</em>.</p>","abstract":false,"args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"Core::Query::Instance(T)"}],"args_string":"(query : Core::Query::Instance(T)) forall T","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L43","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L43","def":{"name":"query","args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"Core::Query::Instance(T)"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"query(T, query.to_s, query.params)"}},{"id":"query(query:String,*params)-instance-method","html_id":"query(query:String,*params)-instance-method","name":"query","doc":"Query `#db` and return raw `DB::ResultSet`.","summary":"<p>Query <code>#db</code> and return raw <code>DB::ResultSet</code>.</p>","abstract":false,"args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(query : String, *params)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L4","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L4","def":{"name":"query","args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":1,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"query = prepare_query(query)\nif params.any?\n  params = Core.prepare_params(*params)\nend\nquery_logger.wrap(query) do\n  db.query(query, *params)\nend\n"}},{"id":"query(model:Schema.class,query:String,*params):Array-instance-method","html_id":"query(model:Schema.class,query:String,*params):Array-instance-method","name":"query","doc":"Query `#db` returning an array of *model* instances.\n\n```\nrepo.query(User, \"SELECT * FROM users\") # => Array(User)\n```\n\nTODO: Handle errors (PQ::PQError)","summary":"<p>Query <code>#db</code> returning an array of <em>model</em> instances.</p>","abstract":false,"args":[{"name":"model","doc":null,"default_value":"","external_name":"model","restriction":"Schema.class"},{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(model : Schema.class, query : String, *params) : Array","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L20","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L20","def":{"name":"query","args":[{"name":"model","doc":null,"default_value":"","external_name":"model","restriction":"Schema.class"},{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":2,"yields":null,"block_arg":null,"return_type":"Array","visibility":"Public","body":"query = prepare_query(query)\nif params.any?\n  params = Core.prepare_params(*params)\nend\nquery_logger.wrap(query) do\n  db.query_all(query, *params) do |rs|\n    rs.read(model)\n  end\nend\n"}},{"id":"query_all(model,query,*params)-instance-method","html_id":"query_all(model,query,*params)-instance-method","name":"query_all","doc":"Query `#db` returning an array of *model* instances.\n\n```\nrepo.query(User, \"SELECT * FROM users\") # => Array(User)\n```\n\nTODO: Handle errors (PQ::PQError)","summary":"<p>Query <code>#db</code> returning an array of <em>model</em> instances.</p>","abstract":false,"args":[{"name":"model","doc":null,"default_value":"","external_name":"model","restriction":""},{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(model, query, *params)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L32","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L32","def":{"name":"query_all","args":[{"name":"model","doc":null,"default_value":"","external_name":"model","restriction":""},{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":""},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":2,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"query(model, query, *params)"}},{"id":"query_all(query)-instance-method","html_id":"query_all(query)-instance-method","name":"query_all","doc":"Query `#db` returning an array of model instances inherited from *query*.\n\n```\nrepo.query(User.all) # => Array(User)\n```\n\nTODO: Handle errors (PQ::PQError)","summary":"<p>Query <code>#db</code> returning an array of model instances inherited from <em>query</em>.</p>","abstract":false,"args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":""}],"args_string":"(query)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L48","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L48","def":{"name":"query_all","args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"query(query)"}},{"id":"query_one(model:Schema.class,query:String,*params):Object-instance-method","html_id":"query_one(model:Schema.class,query:String,*params):Object-instance-method","name":"query_one","doc":"Query `#db` returning a single *model* instance. Will raise `NoResultsError` if query returns no instances.\n\n```\nrepo.query_one(User, \"SELECT * FROM users WHERE id = 1\") # => User\n```","summary":"<p>Query <code>#db</code> returning a single <em>model</em> instance.</p>","abstract":false,"args":[{"name":"model","doc":null,"default_value":"","external_name":"model","restriction":"Schema.class"},{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(model : Schema.class, query : String, *params) : Object","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L75","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L75","def":{"name":"query_one","args":[{"name":"model","doc":null,"default_value":"","external_name":"model","restriction":"Schema.class"},{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":2,"yields":null,"block_arg":null,"return_type":"Object","visibility":"Public","body":"(query_one?(model, query, *params)) || (raise(NoResultsError.new(model.to_s, query)))"}},{"id":"query_one(query:Core::Query::Instance(T))forallT-instance-method","html_id":"query_one(query:Core::Query::Instance(T))forallT-instance-method","name":"query_one","doc":"Query `#db` returning a model instance inherited from *query*. Will raise `NoResultsError` if query returns no instances.\n\n```\nrepo.query_one(User.first) # => User\n```","summary":"<p>Query <code>#db</code> returning a model instance inherited from <em>query</em>.</p>","abstract":false,"args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"Core::Query::Instance(T)"}],"args_string":"(query : Core::Query::Instance(T)) forall T","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L84","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L84","def":{"name":"query_one","args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"Core::Query::Instance(T)"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"query_one(T, query.to_s, query.params)"}},{"id":"query_one?(model:Schema.class,query:String,*params):Object-instance-method","html_id":"query_one?(model:Schema.class,query:String,*params):Object-instance-method","name":"query_one?","doc":"Query `#db` returning a single *model* instance.\n\n```\nrepo.query_one?(User, \"SELECT * FROM users WHERE id = 1\") # => User?\n```","summary":"<p>Query <code>#db</code> returning a single <em>model</em> instance.</p>","abstract":false,"args":[{"name":"model","doc":null,"default_value":"","external_name":"model","restriction":"Schema.class"},{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(model : Schema.class, query : String, *params) : Object","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L57","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L57","def":{"name":"query_one?","args":[{"name":"model","doc":null,"default_value":"","external_name":"model","restriction":"Schema.class"},{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":2,"yields":null,"block_arg":null,"return_type":"Object","visibility":"Public","body":"(query(model, query, *params)).first?"}},{"id":"query_one?(query:Core::Query::Instance(T))forallT-instance-method","html_id":"query_one?(query:Core::Query::Instance(T))forallT-instance-method","name":"query_one?","doc":"Query `#db` returning a model instance inherited from *query*.\n\n```\nrepo.query_one?(User.first) # => User?\n```","summary":"<p>Query <code>#db</code> returning a model instance inherited from <em>query</em>.</p>","abstract":false,"args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"Core::Query::Instance(T)"}],"args_string":"(query : Core::Query::Instance(T)) forall T","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L66","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L66","def":{"name":"query_one?","args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"Core::Query::Instance(T)"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"query_one?(T, query.to_s, query.params)"}}],"macros":[],"types":[{"html_id":"github.com/vladfaust/core/Core/Repository/Query/NoResultsError","path":"Core/Repository/Query/NoResultsError.html","kind":"class","full_name":"Core::Repository::Query::NoResultsError","name":"NoResultsError","abstract":false,"superclass":{"html_id":"github.com/vladfaust/core/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"github.com/vladfaust/core/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"github.com/vladfaust/core/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"github.com/vladfaust/core/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"core/repository/query.cr","line_number":89,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core/Repository/Query","kind":"module","full_name":"Core::Repository::Query","name":"Query"},"doc":"Raised if query returns zero model instances.","summary":"<p>Raised if query returns zero model instances.</p>","class_methods":[],"constructors":[{"id":"new(model_name:String,query:String)-class-method","html_id":"new(model_name:String,query:String)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"model_name","doc":null,"default_value":"","external_name":"model_name","restriction":"String"},{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"}],"args_string":"(model_name : String, query : String)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L96","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L96","def":{"name":"new","args":[{"name":"model_name","doc":null,"default_value":"","external_name":"model_name","restriction":"String"},{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(model_name, query)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"model_name:String-instance-method","html_id":"model_name:String-instance-method","name":"model_name","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L93","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L93","def":{"name":"model_name","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@model_name"}},{"id":"query:String-instance-method","html_id":"query:String-instance-method","name":"query","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L94","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/query.cr#L94","def":{"name":"query","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@query"}}],"macros":[],"types":[]}]},{"html_id":"github.com/vladfaust/core/Core/Repository/Scalar","path":"Core/Repository/Scalar.html","kind":"module","full_name":"Core::Repository::Scalar","name":"Scalar","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"core/repository/scalar.cr","line_number":2,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/scalar.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[{"html_id":"github.com/vladfaust/core/Core/Repository","kind":"class","full_name":"Core::Repository","name":"Repository"}],"namespace":{"html_id":"github.com/vladfaust/core/Core/Repository","kind":"class","full_name":"Core::Repository","name":"Repository"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"scalar(query:Core::Query::Instance(T))forallT-instance-method","html_id":"scalar(query:Core::Query::Instance(T))forallT-instance-method","name":"scalar","doc":"Execute *query* (after stringifying and extracting params) and return a single scalar value.","summary":"<p>Execute <em>query</em> (after stringifying and extracting params) and return a single scalar value.</p>","abstract":false,"args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"Core::Query::Instance(T)"}],"args_string":"(query : Core::Query::Instance(T)) forall T","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/scalar.cr#L20","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/scalar.cr#L20","def":{"name":"scalar","args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"Core::Query::Instance(T)"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"scalar(query.to_s, query.params)"}},{"id":"scalar(query:String,*params)-instance-method","html_id":"scalar(query:String,*params)-instance-method","name":"scalar","doc":"Execute *query* and return a single scalar value.\n\nSee http://crystal-lang.github.io/crystal-db/api/0.5.0/DB/QueryMethods.html#scalar%28query%2C%2Aargs%29-instance-method\n\n```\nrepo.scalar(\"SELECT 1\").as(Int32)\n```","summary":"<p>Execute <em>query</em> and return a single scalar value.</p>","abstract":false,"args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"args_string":"(query : String, *params)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/scalar.cr#L10","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/scalar.cr#L10","def":{"name":"scalar","args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"String"},{"name":"params","doc":null,"default_value":"","external_name":"params","restriction":""}],"double_splat":null,"splat_index":1,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"query = prepare_query(query)\nif params.any?\n  params = Core.prepare_params(*params)\nend\nquery_logger.wrap(query) do\n  db.scalar(query, *params)\nend\n"}}],"macros":[],"types":[]},{"html_id":"github.com/vladfaust/core/Core/Repository/Update","path":"Core/Repository/Update.html","kind":"module","full_name":"Core::Repository::Update","name":"Update","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"core/repository/update.cr","line_number":2,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/update.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[{"html_id":"github.com/vladfaust/core/Core/Repository","kind":"class","full_name":"Core::Repository","name":"Repository"}],"namespace":{"html_id":"github.com/vladfaust/core/Core/Repository","kind":"class","full_name":"Core::Repository","name":"Repository"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"update(query:Core::Query::Instance)forallT-instance-method","html_id":"update(query:Core::Query::Instance)forallT-instance-method","name":"update","doc":"Issue an update query. Basically the same as `#exec` just calling `query.update` before.\n\n```\nrepo.update(User.set(active: true).where(id: 1))\n# Equals to\nrepo.exec(User.update.set(active: true).where(id: 1))\n```","summary":"<p>Issue an update query.</p>","abstract":false,"args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"Core::Query::Instance"}],"args_string":"(query : Core::Query::Instance) forall T","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/update.cr#L10","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/update.cr#L10","def":{"name":"update","args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":"Core::Query::Instance"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"query.update\nexec(query.to_s, query.params)\n"}},{"id":"update(instance:Schema)-instance-method","html_id":"update(instance:Schema)-instance-method","name":"update","doc":"Update single *instance*.\nOnly fields appearing in `Schema#changes` are affected.\nReturns `DB::ExecResult`.\n\nNOTE: Does not check if `Schema::Validation#valid?`.\nNOTE: To update multiple instances, exec custom query (this is because instances may have different changes).\n\nTODO: Handle errors.\nTODO: [RFC] Call `#query` and return `Schema` instance instead (see https://github.com/will/crystal-pg/issues/101).","summary":"<p>Update single <em>instance</em>.</p>","abstract":false,"args":[{"name":"instance","doc":null,"default_value":"","external_name":"instance","restriction":"Schema"}],"args_string":"(instance : Schema)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/update.cr#L28","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/repository/update.cr#L28","def":{"name":"update","args":[{"name":"instance","doc":null,"default_value":"","external_name":"instance","restriction":"Schema"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"fields = instance.fields.select do |k, _|\n  instance.changes.keys.includes?(k)\nend\nif fields.any?\nelse\n  return\nend\nquery = SQL_UPDATE % {table_name: instance.class.table, set_fields: fields.keys.map do |f|\n  instance.class.fields[f][:key] + \" = ?\"\nend.join(\", \"), primary_key: instance.class.primary_key[:name]}\nexec(query, fields.values.push(instance.primary_key))\n"}}],"macros":[],"types":[]}]},{"html_id":"github.com/vladfaust/core/Core/Schema","path":"Core/Schema.html","kind":"module","full_name":"Core::Schema","name":"Schema","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"core/schema/changes.cr","line_number":2,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/schema/changes.cr"},{"filename":"core/schema/fields.cr","line_number":2,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/schema/fields.cr"},{"filename":"core/schema/getters.cr","line_number":2,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/schema/getters.cr"},{"filename":"core/schema/initializer.cr","line_number":2,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/schema/initializer.cr"},{"filename":"core/schema/mapping.cr","line_number":4,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/schema/mapping.cr"},{"filename":"core/schema/references.cr","line_number":2,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/schema/references.cr"},{"filename":"core/schema.cr","line_number":39,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/schema.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core","kind":"module","full_name":"Core","name":"Core"},"doc":"Schema defines mapping between database and model.\n\n```\nclass User\n  include Core::Schema\n\n  schema \"users\" do\n    primary_key :id\n\n    reference :referrer, self, key: :referrer_id\n    reference :referrals, self, foreign_key: :referrer_id\n    reference :posts, Post, foreign_key: :author_id\n\n    field :name, String\n    field :age, Int32?\n    field :created_at, Time, db_default: true\n  end\nend\n\nclass Post\n  include Core::Schema\n\n  schema \"posts\" do\n    primary_key :id\n    reference :author, User, key: :author_id\n\n    field :content, String\n    field :created_at, Time, db_default: true\n    field :updated_at, Time?\n  end\nend\n```","summary":"<p>Schema defines mapping between database and model.</p>","class_methods":[],"constructors":[],"instance_methods":[],"macros":[{"id":"field(name,type_type,**options)-macro","html_id":"field(name,type_type,**options)-macro","name":"field","doc":"Define a schema field, generating properties for each field.\n\nPossible *options*:\n- *default* (`Proc?`) - Proc called for the field on instance initialization if it's `nil`;\n- *nilable* (`Bool?`) - Whether is this field nilable. Has the same effect as providing a nilable *type*. If nilable, will generate `getter!`, otherwise just `getter` (see https://crystal-lang.org/api/0.24.2/Object.html#getter%21%28%2Anames%29-macro);\n- *db_default* (`Bool?`) - Whether is this field has `DEFAULT` value handled by database. As a result, when an instance is initialized explicitly (e.g. `User.new`), this field **will not** be checked against `nil`. However, if an instance is initialized implicitly (e.g. `from_rs` or `User.new(explicitly_initialized: false)`), then this field **will** be checked against `nil`, failing validation if not nilable.\n- *primary_key* (`Bool?`) - Is this field a primary key? See `#primary_key`;\n- *key* (`Symbol?`) - Column name for this field. Defaults to *name*;\n- *converter* (`Object?`) - An object extending `Core::Converter`;\n\n```\nschema do\n  field :active, Bool, db_default: true\n  field :name, String, default: \"A User\", key: :name_column\n  field :age, Int32?\nend\n```","summary":"<p>Define a schema field, generating properties for each field.</p>","abstract":false,"args":[{"name":"name","doc":null,"default_value":"","external_name":"name","restriction":""},{"name":"_type","doc":null,"default_value":"","external_name":"type","restriction":""}],"args_string":"(name, type _type, **options)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/schema/fields.cr#L20","def":{"name":"field","args":[{"name":"name","doc":null,"default_value":"","external_name":"name","restriction":""},{"name":"_type","doc":null,"default_value":"","external_name":"type","restriction":""}],"double_splat":{"name":"options","doc":null,"default_value":"","external_name":"options","restriction":""},"splat_index":null,"block_arg":null,"visibility":"Public","body":"      \n{% nilable = options[:nilable].id == \"nil\".id ? (\"#{_type}\".includes?(\"::Nil\")) || (\"#{_type}\".ends_with?(\"?\")) : options[:nilable] %}\n\n\n      @\n{{ name.id }}\n : \n{{ _type.id }}\n | Nil\n      setter \n{{ name.id }}\n\n      getter\n{{ unless nilable\n  \"!\".id\nend }}\n \n{{ name.id }}\n\n\n      \n{% if options[:primary_key] %}\n        PRIMARY_KEY = {\n          name: {{ name }},\n          type: {{ _type.id }},\n        }\n\n        def self.primary_key\n          PRIMARY_KEY\n        end\n\n        def primary_key\n          @{{ name.id }}.not_nil!\n        end\n\n        def ==(other : self)\n          self.primary_key == other.primary_key\n        end\n      {% end %}\n\n\n      \n{% converter = if options[:converter]\n  if options[:converter].is_a?(Generic)\n    (options[:converter].name.resolve.stringify.gsub(/\\(\\w+\\)/, (\"(\" + options[:converter].type_vars.first.resolve.stringify) + \")\")).id\n  else\n    options[:converter]\n  end\nelse\n  nil\nend %}\n\n\n      \n{% INTERNAL__CORE_FIELDS.push({name: name, type: (if _type.is_a?(Generic)\n  _type\nelse\n  _type.resolve\nend), nilable: nilable, db_default: !(!options[:db_default]), default: options[:default], converter: converter, key: options[:key] || name, options: options.empty? ? nil : options}) %}\n\n      \n"}},{"id":"primary_key(name,type_type=::Union(Core::PrimaryKey,::Nil),**options)-macro","html_id":"primary_key(name,type_type=::Union(Core::PrimaryKey,::Nil),**options)-macro","name":"primary_key","doc":"Define a primary key field.\n\n```\nclass User\n  include Core::Schema\n\n  schema do\n    primary_key :id\n    # Is an alias of\n    field :id, Core::PrimaryKey?, primary_key: true\n  end\nend\n\nUser.primary_key # => :id\nuser = User.new(id: 42)\nuser.primary_key_value # => 42\n```\n\nThe *type* is `Core::PrimaryKey?` by default, but you pass whatever you want:\n\n```\nschema do\n  primary_key :uuid, String, default: SecureRandom.uuid\nend\n```","summary":"<p>Define a primary key field.</p>","abstract":false,"args":[{"name":"name","doc":null,"default_value":"","external_name":"name","restriction":""},{"name":"_type","doc":null,"default_value":"::Union(Core::PrimaryKey, ::Nil)","external_name":"type","restriction":""}],"args_string":"(name, type _type = ::Union(Core::PrimaryKey, ::Nil), **options)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/schema/fields.cr#L101","def":{"name":"primary_key","args":[{"name":"name","doc":null,"default_value":"","external_name":"name","restriction":""},{"name":"_type","doc":null,"default_value":"::Union(Core::PrimaryKey, ::Nil)","external_name":"type","restriction":""}],"double_splat":{"name":"options","doc":null,"default_value":"","external_name":"options","restriction":""},"splat_index":null,"block_arg":null,"visibility":"Public","body":"      field(\n{{ name }}\n, \n{{ _type }}\n, primary_key: true, \n{{ **options }}\n)\n    \n"}},{"id":"reference(name,classklass,key=nil,key_type=nil,foreign_key=nil)-macro","html_id":"reference(name,classklass,key=nil,key_type=nil,foreign_key=nil)-macro","name":"reference","doc":"Define a reference.\n\nGenerates an always nilable property, as well as initializers, for example:\n\n```\nschema do\n  reference :referrer, User\n  reference :posts, Array(Post)\nend\n\n# Will expand into:\n\nproperty referrer : User?\nproperty posts : Array(Post)?\n\ndef initialize(@referrer : User? = nil, @posts : Array(Post)? = nil)\nend\n```\n\nIf a *key* argument is given, also generates a field property. Basically, the key should copy one from SQL schema. For example:\n\n```\nschema do\n  primary_key :id\n  reference :referrer, User, key: :referrer_id\n  reference :creator, User, key: :creator_id\nend\n\n# Will expand in:\n\nproperty referrer : User?\nproperty referrer_id : PrimaryKey?\nproperty creator : User?\nproperty creator_id : PrimaryKey?\n\ndef initialize(\n  @id : PrimaryKey? = nil,\n  @referrer : User? = nil,\n  @creator : User? = nil,\n  @referrer_id : PrimaryKey? = nil,\n  @creator_id : PrimaryKey? = nil\n)\n  @referrer_id ||= @referrer.try &.id # Smart!\n  @creator_id ||= @creator.try &.id\nend\n```\n\nA reference's primary key is obtained from the reference *class* itself, or, if given, from *foreign_key*. But remember that *foreign_key* is required for `Query::Instance#join`.\n\nAnother example:\n\n```\nmodule Models\n  class User\n    include Core::Schema\n\n    schema \"users\" do\n      primary_key :id\n      reference :referrer, User, key: :referrer_id\n      reference :referrals, Array(User), foreign_key: :referrer_id\n      reference :posts, Array(Post), foreign_key: :author_id\n    end\n  end\n\n  class Post\n    include Core::Schema\n\n    schema \"posts\" do\n      reference :author, User, key: :author_id\n    end\n  end\nend\n```","summary":"<p>Define a reference.</p>","abstract":false,"args":[{"name":"name","doc":null,"default_value":"","external_name":"name","restriction":""},{"name":"klass","doc":null,"default_value":"","external_name":"class","restriction":""},{"name":"key","doc":null,"default_value":"nil","external_name":"key","restriction":""},{"name":"key_type","doc":null,"default_value":"nil","external_name":"key_type","restriction":""},{"name":"foreign_key","doc":null,"default_value":"nil","external_name":"foreign_key","restriction":""}],"args_string":"(name, class klass, key = nil, key_type = nil, foreign_key = nil)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/schema/references.cr#L76","def":{"name":"reference","args":[{"name":"name","doc":null,"default_value":"","external_name":"name","restriction":""},{"name":"klass","doc":null,"default_value":"","external_name":"class","restriction":""},{"name":"key","doc":null,"default_value":"nil","external_name":"key","restriction":""},{"name":"key_type","doc":null,"default_value":"nil","external_name":"key_type","restriction":""},{"name":"foreign_key","doc":null,"default_value":"nil","external_name":"foreign_key","restriction":""}],"double_splat":null,"splat_index":null,"block_arg":null,"visibility":"Public","body":"      \n{% _type = klass.is_a?(Generic) ? klass.type_vars.first : klass\nis_array = klass.is_a?(Generic) ? klass.name.resolve.name == \"Array(T)\" : false\n %}\n\n\n      macro finished\n        \n\\{%\n          fo\nreign_key = \n{{ foreign_key }}\n.is_a?(NilLiteral) ? \n{{ _type }}\n.constant(\"PRIMARY_KEY\")[:name] : \n{{ foreign_key }}\n\n\n          INTERNAL__CORE_REFERENCES.push(\n{\n            name:        \n{{ name }}\n,\n            \"class\":     \n{{ klass.stringify }}\n,\n            type:        \n{{ _type }}\n,\n            array:       \n{{ is_array }}\n,\n            key:         \n{{ key }}\n,\n            foreign_key: foreign_key,\n          })\n        %}\n\n        property \n{{ name.id }}\n : \n{{ klass.id }}\n | Nil\n\n        \n\\{% if\n \n{{ key }}\n %}\n          \n\\{% \nkey_type = \n{{ key_type }}\n.is_a?(NilLiteral) ? \n{{ _type }}\n.constant(\"PRIMARY_KEY\")[:type] : \n{{ key_type }}\n %}\n          field(\n{{ key }}\n, \n\\{\n{key_type}}, nilable: true)\n        \n\\{% end\n %}\n      \nend\n    \n"}},{"id":"schema(table)-macro","html_id":"schema(table)-macro","name":"schema","doc":"A basic macro for schema definition.\nAll other macros have to be called **within** the *block*.\nIt should only be called **once** per model.\n\n```\nclass User\n  include Core::Schema\n\n  schema \"users\" do\n    primary_key :id\n  end\nend\n```","summary":"<p>A basic macro for schema definition.</p>","abstract":false,"args":[{"name":"table","doc":null,"default_value":"","external_name":"table","restriction":""}],"args_string":"(table)","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/schema.cr#L53","def":{"name":"schema","args":[{"name":"table","doc":null,"default_value":"","external_name":"table","restriction":""}],"double_splat":null,"splat_index":null,"block_arg":{"name":"block","doc":null,"default_value":"","external_name":"block","restriction":""},"visibility":"Public","body":"      INTERNAL__CORE_FIELDS = [] of NamedTuple\n      INTERNAL__CORE_REFERENCES = [] of NamedTuple\n      INTERNAL__CORE_CREATED_AT_FIELDS = [] of Symbol\n      INTERNAL__CORE_UPDATED_AT_FIELDS = [] of Symbol\n\n      \n{{ yield }}\n\n\n      define_getters(\n{{ table }}\n)\n      define_initializer\n      define_db_mapping\n      define_changes\n\n      \n{% if @type < Core::Validation %}\n        define_validation\n      {% end %}\n\n    \n"}}],"types":[]},{"html_id":"github.com/vladfaust/core/Core/Validation","path":"Core/Validation.html","kind":"module","full_name":"Core::Validation","name":"Validation","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"core/validation.cr","line_number":39,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/validation.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core","kind":"module","full_name":"Core","name":"Core"},"doc":"A module which helps to validate models in a convenient way.\n\nIt has to be included into a model **explicitly**.\n\nImplemented inline validations (defined as `:validate` option on field):\n- *size* (`Range | Int32`) - Validate size;\n- *min* (`Comparable`) - Check if field value `>=` than min;\n- *max* (`Comparable`) - Check if field value `<=` than max;\n- *min!* (`Comparable`) - Check if field value `>` than min;\n- *max!* (`Comparable`) - Check if field value `<` than max;\n- *in* (`Enumerable`) - Validate if field value is included in range or array etc.;\n- *regex* (`Regex`) - Validate if field value matches regex;\n- *custom* (`Proc`) - Custom validation, see example below;\n\n```\nclass User\n  include Core::Schema\n  include Core::Validation\n\n  schema do\n    field :name, String, validate: {\n      size:   (3..32),\n      regex:  /\\w+/,\n      custom: ->(name : String) {\n        error!(:name, \"Some condition not met\") unless some_condition?(name)\n      },\n    }\n    field :age, Int32?, validate: {in: (18..150)}\n  end\n\n  validate do\n    error!(:custom_field, \"some error occured\") unless some_condition\n  end\nend\n```\n\nNOTE: A `#nil?` validation will be run at first if the field is defined as non-nilable.","summary":"<p>A module which helps to validate models in a convenient way.</p>","class_methods":[],"constructors":[],"instance_methods":[],"macros":[{"id":"define_validation-macro","html_id":"define_validation-macro","name":"define_validation","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/validation.cr#L40","def":{"name":"define_validation","args":[],"double_splat":null,"splat_index":null,"block_arg":null,"visibility":"Public","body":"      getter \nerrors = Array(Hash(Symbol, String)).new\n\n      \n# Add an error to `errors`, stopping further validations.\n\n      \n#\n\n      \n# ```\n\n      \n# field :name, String, validate: ->(n : String) \n{ error!(:name, \"invalid\") }\n\n      \n# ...\n\n      \n# validate do\n\n      \n#   error!(:name, \"another error\")\n\n      \n#   will_not_be_called\n\n      \n# end\n\n      \n# ```\n\n      protected def \nerror!(field, description)\n        @errors.push(\n{field => description})\n        raise Throw.new\n      \nend\n\n      \n# Check if the model is valid.\n\n      def valid?\n        validate\n        @errors.empty?\n      \nend\n\n      \n# Ensure that the model is valid, otherwise raise `ValidationError`.\n\n      def valid!\n        raise ValidationError.new(self.class, @errors) unless valid?\n        return self\n      \nend\n\n      \n# Execute validation; should be called manually, prefer `valid?`.\n\n      def validate\n        @errors.clear\n\n        \n{% for _field in INTERNAL__CORE_FIELDS %}\n          begin\n            {{ field = _field[:name] }}\n\n            if @{{ field.id }}.nil?\n              if !{{ _field[:nilable] }} && !({{ _field[:db_default] }} && explicitly_initialized)\n                error!({{ field }}, \"must not be nil\")\n              end\n            else\n              {% if validations = _field[:options] && _field[:options][:validate] %}\n                value = @{{ field.id }}.not_nil!\n\n                {% if validations[:size] %}\n                  case size = {{ validations[:size].id }}\n                  when Int32\n                    unless value.size == size\n                      error!({{ field }}, \"must have exact size of #{size}\")\n                    end\n                  when Range\n                    unless (size).includes?(value.size)\n                      error!({{ field }}, \"must have size in range of #{size}\")\n                    end\n                  end\n                {% end %}\n\n                {% if validations[:in] %}\n                  unless ({{ validations[:in] }}).includes?(value)\n                    error!({{ field }}, \"must be included in {{ validations[:in].id }}\")\n                  end\n                {% end %}\n\n                {% if validations[:min] %}\n                  unless value >= {{ validations[:min] }}\n                    error!({{ field }}, \"must be greater or equal to {{ validations[:min].id }}\")\n                  end\n                {% end %}\n\n                {% if validations[:max] %}\n                  unless value <= {{ validations[:max] }}\n                    error!({{ field }}, \"must be less or equal to {{ validations[:max].id }}\")\n                  end\n                {% end %}\n\n                {% if validations[:\"min!\"] %}\n                  unless value > {{ validations[:\"min!\"] }}\n                    error!({{ field }}, \"must be greater than {{ validations[:\"min!\"].id }}\")\n                  end\n                {% end %}\n\n                {% if validations[:\"max!\"] %}\n                  unless value < {{ validations[:\"max!\"] }}\n                    error!({{ field }}, \"must be less than {{ validations[:\"max!\"].id }}\")\n                  end\n                {% end %}\n\n                {% if validations[:regex] %}\n                  unless {{ validations[:regex] }}.match(value)\n                    error!({{ field }}, \"must match {{ validations[:regex].id }}\")\n                  end\n                {% end %}\n\n                {% if validations[:custom] %}\n                  {{ validations[:custom].id }}.call(value)\n                {% end %}\n              {% end %}\n            end\n          rescue ex : Throw\n          end\n        {% end %}\n\n      \nend\n    \n"}}],"types":[{"html_id":"github.com/vladfaust/core/Core/Validation/ValidationError","path":"Core/Validation/ValidationError.html","kind":"class","full_name":"Core::Validation::ValidationError","name":"ValidationError","abstract":false,"superclass":{"html_id":"github.com/vladfaust/core/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"github.com/vladfaust/core/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"github.com/vladfaust/core/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"github.com/vladfaust/core/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"core/validation.cr","line_number":168,"url":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/validation.cr"}],"repository_name":"github.com/vladfaust/core","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/vladfaust/core/Core/Validation","kind":"module","full_name":"Core::Validation","name":"Validation"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"id":"new(model,errors:Array(Hash(Symbol,String)))-class-method","html_id":"new(model,errors:Array(Hash(Symbol,String)))-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"model","doc":null,"default_value":"","external_name":"model","restriction":""},{"name":"errors","doc":null,"default_value":"","external_name":"errors","restriction":"Array(Hash(Symbol, String))"}],"args_string":"(model, errors : Array(Hash(Symbol, String)))","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/validation.cr#L171","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/validation.cr#L171","def":{"name":"new","args":[{"name":"model","doc":null,"default_value":"","external_name":"model","restriction":""},{"name":"errors","doc":null,"default_value":"","external_name":"errors","restriction":"Array(Hash(Symbol, String))"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(model, errors)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"errors:Array(Hash(Symbol,String))-instance-method","html_id":"errors:Array(Hash(Symbol,String))-instance-method","name":"errors","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Array(Hash(Symbol, String))","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/validation.cr#L169","source_link":"https://github.com/vladfaust/core/blob/078e398c5804dbed6a59bd6a3e260de5cc91bd95/src/core/validation.cr#L169","def":{"name":"errors","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@errors"}}],"macros":[],"types":[]}]}]}]}})
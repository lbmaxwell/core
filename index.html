<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 0.25.1">


<link href="css/style.css" rel="stylesheet" type="text/css">

<script type="text/javascript" src="js/doc.js"></script>
<script type="text/javascript">
  CrystalDoc.base_path = "";
</script>

  <meta id="repository-name" content="github.com/vladfaust/core">
  <title>README - github.com/vladfaust/core</title>
</head>
<body>

<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false">
    </div>

    <div class="repository-links">
      <a href="index.html">README</a>
    </div>
  </div>

  <div class="search-results" class="hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class=" " data-id="github.com/vladfaust/core/Array" data-name="array(t)">
      <a href="Array.html">Array</a>
      
    </li>
  
  <li class="parent " data-id="github.com/vladfaust/core/Core" data-name="core">
      <a href="Core.html">Core</a>
      
        <ul>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/Converter" data-name="core::converter(t)">
      <a href="Core/Converter.html">Converter</a>
      
    </li>
  
  <li class="parent " data-id="github.com/vladfaust/core/Core/Converters" data-name="core::converters">
      <a href="Core/Converters.html">Converters</a>
      
        <ul>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/Converters/Enum" data-name="core::converters::enum(enumclass)">
      <a href="Core/Converters/Enum.html">Enum</a>
      
    </li>
  
  <li class="parent " data-id="github.com/vladfaust/core/Core/Converters/PG" data-name="core::converters::pg">
      <a href="Core/Converters/PG.html">PG</a>
      
        <ul>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/Converters/PG/Numeric" data-name="core::converters::pg::numeric">
      <a href="Core/Converters/PG/Numeric.html">Numeric</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/vladfaust/core/Core/Logger" data-name="core::logger">
      <a href="Core/Logger.html">Logger</a>
      
        <ul>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/Logger/Dummy" data-name="core::logger::dummy">
      <a href="Core/Logger/Dummy.html">Dummy</a>
      
    </li>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/Logger/IO" data-name="core::logger::io">
      <a href="Core/Logger/IO.html">IO</a>
      
    </li>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/Logger/Standard" data-name="core::logger::standard">
      <a href="Core/Logger/Standard.html">Standard</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/Param" data-name="core::param">
      <a href="Core/Param.html">Param</a>
      
    </li>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/PrimaryKey" data-name="core::primarykey">
      <a href="Core/PrimaryKey.html">PrimaryKey</a>
      
    </li>
  
  <li class="parent " data-id="github.com/vladfaust/core/Core/Query" data-name="core::query">
      <a href="Core/Query.html">Query</a>
      
        <ul>
  
  <li class="parent " data-id="github.com/vladfaust/core/Core/Query/Instance" data-name="core::query::instance(schema)">
      <a href="Core/Query/Instance.html">Instance</a>
      
        <ul>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/Query/Instance/InternalHavingTuple" data-name="core::query::instance::internalhavingtuple">
      <a href="Core/Query/Instance/InternalHavingTuple.html">InternalHavingTuple</a>
      
    </li>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/Query/Instance/InternalWhereTuple" data-name="core::query::instance::internalwheretuple">
      <a href="Core/Query/Instance/InternalWhereTuple.html">InternalWhereTuple</a>
      
    </li>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/Query/Instance/QueryType" data-name="core::query::instance::querytype">
      <a href="Core/Query/Instance/QueryType.html">QueryType</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/vladfaust/core/Core/Repository" data-name="core::repository">
      <a href="Core/Repository.html">Repository</a>
      
        <ul>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/Repository/Delete" data-name="core::repository::delete">
      <a href="Core/Repository/Delete.html">Delete</a>
      
    </li>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/Repository/Exec" data-name="core::repository::exec">
      <a href="Core/Repository/Exec.html">Exec</a>
      
    </li>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/Repository/Insert" data-name="core::repository::insert">
      <a href="Core/Repository/Insert.html">Insert</a>
      
    </li>
  
  <li class="parent " data-id="github.com/vladfaust/core/Core/Repository/Query" data-name="core::repository::query">
      <a href="Core/Repository/Query.html">Query</a>
      
        <ul>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/Repository/Query/NoResultsError" data-name="core::repository::query::noresultserror">
      <a href="Core/Repository/Query/NoResultsError.html">NoResultsError</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/Repository/Scalar" data-name="core::repository::scalar">
      <a href="Core/Repository/Scalar.html">Scalar</a>
      
    </li>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/Repository/Update" data-name="core::repository::update">
      <a href="Core/Repository/Update.html">Update</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/Schema" data-name="core::schema">
      <a href="Core/Schema.html">Schema</a>
      
    </li>
  
  <li class="parent " data-id="github.com/vladfaust/core/Core/Validation" data-name="core::validation">
      <a href="Core/Validation.html">Validation</a>
      
        <ul>
  
  <li class=" " data-id="github.com/vladfaust/core/Core/Validation/ValidationError" data-name="core::validation::validationerror">
      <a href="Core/Validation/ValidationError.html">ValidationError</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<h1><img src="https://user-images.githubusercontent.com/7955682/40578252-6f1929b2-6119-11e8-9348-81505cec939f.png" alt="Core"/></h1>

<p><a href="https://crystal-lang.org/" target="_blank"><img src="https://img.shields.io/badge/built%20with-crystal-000000.svg?style=flat-square" alt="Built with Crystal"/></a>
<a href="https://travis-ci.org/vladfaust/core" target="_blank"><img src="https://img.shields.io/travis/vladfaust/core/master.svg?style=flat-square" alt="Build status"/></a>
<a href="https://github.vladfaust.com/core" target="_blank"><img src="https://img.shields.io/badge/docs-available-brightgreen.svg?style=flat-square" alt="Docs"/></a>
<a href="https://github.com/vladfaust/core/releases" target="_blank"><img src="https://img.shields.io/github/release/vladfaust/core.svg?style=flat-square" alt="Releases"/></a>
<a href="https://github.com/veelenga/awesome-crystal" target="_blank"><img src="https://img.shields.io/badge/style-awesome-lightgrey.svg?longCache=true&style=flat-square&label=&colorA=fc60a8&colorB=494368&status=ok&logo=data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIgICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiICAgd2lkdGg9IjE1NC43ODEyNW1tIiAgIGhlaWdodD0iODAuMTE1ODI5bW0iICAgdmlld0JveD0iMCAwIDE1NC43ODEyNSA4MC4xMTU4MjkiICAgdmVyc2lvbj0iMS4xIiAgIGlkPSJzdmc4IiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTIuMSByMTUzNzEiICAgc29kaXBvZGk6ZG9jbmFtZT0iYXdlc29tZS5zdmciPiAgPGRlZnMgICAgIGlkPSJkZWZzMiIgLz4gIDxzb2RpcG9kaTpuYW1lZHZpZXcgICAgIGlkPSJiYXNlIiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiICAgICBib3JkZXJvcGFjaXR5PSIxLjAiICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIgICAgIGlua3NjYXBlOnpvb209IjAuNyIgICAgIGlua3NjYXBlOmN4PSIxMzMuMTU2NTYiICAgICBpbmtzY2FwZTpjeT0iMTAxLjUzNjMiICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0ibW0iICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiICAgICBzaG93Z3JpZD0iZmFsc2UiICAgICBmaXQtbWFyZ2luLXRvcD0iMCIgICAgIGZpdC1tYXJnaW4tbGVmdD0iMCIgICAgIGZpdC1tYXJnaW4tcmlnaHQ9IjAiICAgICBmaXQtbWFyZ2luLWJvdHRvbT0iMCIgICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTkyMCIgICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjEwMTciICAgICBpbmtzY2FwZTp3aW5kb3cteD0iLTgiICAgICBpbmtzY2FwZTp3aW5kb3cteT0iLTgiICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIxIiAvPiAgPG1ldGFkYXRhICAgICBpZD0ibWV0YWRhdGE1Ij4gICAgPHJkZjpSREY+ICAgICAgPGNjOldvcmsgICAgICAgICByZGY6YWJvdXQ9IiI+ICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4gICAgICAgIDxkYzp0eXBlICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+ICAgICAgPC9jYzpXb3JrPiAgICA8L3JkZjpSREY+ICA8L21ldGFkYXRhPiAgPGcgICAgIGlua3NjYXBlOmxhYmVsPSJMYXllciAxIiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIgICAgIGlkPSJsYXllcjEiICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMzIuMjA5MjQzLC05OS4zODI3MDcpIj4gICAgPHBhdGggICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZjtzdHJva2Utd2lkdGg6MC4yNjQ1ODMzMiIgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIgICAgICAgZD0ibSAxODYuOTkwNDksMTM1LjgxNTgzIC0zOS42ODc1LC0zNi40MDY2NjQgLTUuNTgyNzEsNi4wODU0MTQgMzMuMDcyOTIsMzAuMzIxMjUgSCA0NC40MzI5OTQgTCA3Ny41MDU5MSwxMDUuNDY4MTIgNzEuOTIzMjAyLDk5LjM4MjcwNyAzMi4yMzU3MDMsMTM1LjgxNTgzIGggLTAuMDI2NDYgdiAyMy45OTc3MSBjIDAsMTAuODQ3OTEgMTAuNDUxMDQxLDE5LjY4NSAyMy4yODMzMzIsMTkuNjg1IGggMjQuNDczOTU4IGMgMTIuODMyMjkyLDAgMjMuMjgzMzM3LC04LjgzNzA5IDIzLjI4MzMzNywtMTkuNjg1IHYgLTE1Ljc2OTE3IGggMTIuNyB2IDE1Ljc2OTE3IGMgMCwxMC44NDc5MSAxMC40NTEwNCwxOS42ODUgMjMuMjgzMzMsMTkuNjg1IGggMjQuNDczOTYgYyAxMi44MzIyOSwwIDIzLjI4MzMzLC04LjgzNzA5IDIzLjI4MzMzLC0xOS42ODUgeiIgICAgICAgaWQ9InBhdGg0NDg3IiAvPiAgPC9nPjwvc3ZnPg==" alt="Awesome"/></a>
<a href="https://vladfaust.com" target="_blank"><img src="https://img.shields.io/badge/style-.com-lightgrey.svg?longCache=true&style=flat-square&label=vladfaust&colorB=0a83d8" alt="vladfaust.com"/></a></p>

<p>Core is an expressive modular ORM for <a href="https://crystal-lang.org" target="_blank">Crystal</a> featuring:</p>

<ul><li>‚ö°Ô∏è <strong>Efficiency</strong> based on <a href="https://crystal-lang.org" target="_blank">Crystal</a> performance</li><li>‚ú® <strong>Expressiveness</strong> with powerful DSL and lesser code</li><li>üíº <strong>Safety</strong> with strictly typed attributes</li></ul>

<h2>About</h2>

<p>Core does not follow Active Record pattern, it's more like a data-mapping solution. There is a concept of Repository, which is basically a gateway to the database. For example:</p>

<pre><code class="language-crystal">repo <span class="o">=</span> <span class="t">Core</span><span class="t">::</span><span class="t">Repository</span>.<span class="k">new</span>(db)
users <span class="o">=</span> repo.query(<span class="t">User</span>, <span class="s">&quot;SELECT * FROM users WHERE id &gt; 42&quot;</span>)
users.<span class="k">class</span> <span class="c"># =&gt; Array(User)</span></code></pre>

<p>Core also has a plently of features, including:</p>

<ul><li>Expressive Query builder, either standalone or module, allowing to use constructions like <code>Post.join(:author).where(author: user)</code>, which turns into a plain SQL</li><li>References preloader (the example above would return a <code>Post</code> which has <code>#author = <User @id=42></code> attribute)</li><li>Validations module allowing to perform both inline and custom validations (<code>user.valid? # => true</code>)</li></ul>

<p>However, Core is designed to be minimal, so it doesn't perform task you may got used to, for example, it doesn't do database migrations itself. You may use <a href="https://github.com/vladfaust/migrate.cr" target="_blank">migrate</a> instead.</p>

<h2>Installation</h2>

<p>Add this to your application's <code>shard.yml</code>:</p>

<pre><code class="language-yaml">dependencies:
  core:
    github: vladfaust/core
    version: ~> 0.4.0 # See actual version in releases</code></pre>

<p>This shard follows <a href="http://semver.org/" target="_blank">Semantic Versioning v2.0.0</a>, so check <a href="https://github.com/vladfaust/core/releases" target="_blank">releases</a> and change the <code>version</code> accordingly.</p>

<h2>Basic example</h2>

<p>Assuming following database schema:</p>

<pre><code class="language-sql">CREATE TABLE users(
  id          SERIAL        PRIMARY KEY,
  name        VARCHAR(100)  NOT NULL,
  created_at  TIMESTAMPTZ   NOT NULL  DEFAULT NOW()
);

CREATE TABLE posts(
  id          SERIAL      PRIMARY KEY,
  author_id   INT         NOT NULL  REFERENCES users (id),
  content     TEXT        NOT NULL,
  created_at  TIMESTAMPTZ NOT NULL  DEFAULT NOW(),
  updated_at  TIMESTAMPTZ
);</code></pre>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;core&quot;</span>
<span class="k">require</span> <span class="s">&quot;pg&quot;</span> <span class="c"># Or maybe another driver</span>

<span class="k">class</span> <span class="t">User</span>
  <span class="k">include</span> <span class="t">Core</span><span class="t">::</span><span class="t">Schema</span>
  <span class="k">include</span> <span class="t">Core</span><span class="t">::</span><span class="t">Query</span>
  <span class="k">include</span> <span class="t">Core</span><span class="t">::</span><span class="t">Validations</span>

  schema <span class="n">:users</span> <span class="k">do</span>
    primary_key <span class="n">:id</span>
    reference <span class="n">:posts</span>, <span class="t">Array</span>(<span class="t">Post</span>), foreign_key: <span class="n">:author_id</span>

    field <span class="n">:name</span>, <span class="t">String</span>, validate: {size: (<span class="n">3</span>..<span class="n">100</span>)}
    field <span class="n">:created_at</span>, <span class="t">Time</span>, db_default: <span class="n">true</span> <span class="c"># Means that DB is handling the default value</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="t">Post</span>
  <span class="k">include</span> <span class="t">Core</span><span class="t">::</span><span class="t">Schema</span>
  <span class="k">include</span> <span class="t">Core</span><span class="t">::</span><span class="t">Query</span>
  <span class="k">include</span> <span class="t">Core</span><span class="t">::</span><span class="t">Validations</span>

  schema <span class="n">:posts</span> <span class="k">do</span>
    primary_key <span class="n">:id</span>
    reference <span class="n">:author</span>, <span class="t">User</span>, key: <span class="n">:author_id</span>

    field <span class="n">:content</span>, <span class="t">String</span>
    field <span class="n">:created_at</span>, <span class="t">Time</span>, db_default: <span class="n">true</span>
    field <span class="n">:updated_at</span>, <span class="t">Time</span>?
  <span class="k">end</span>
<span class="k">end</span>

db <span class="o">=</span> <span class="t">DB</span>.open(<span class="t">ENV</span>[<span class="s">&quot;DATABASE_URL&quot;</span>])
query_logger <span class="o">=</span> <span class="t">Core</span><span class="t">::</span><span class="t">Logger</span><span class="t">::</span><span class="t">IO</span>.<span class="k">new</span>(<span class="t">STDOUT</span>)
repo <span class="o">=</span> <span class="t">Core</span><span class="t">::</span><span class="t">Repository</span>.<span class="k">new</span>(db, query_logger)

user <span class="o">=</span> <span class="t">User</span>.<span class="k">new</span>(name: <span class="s">&quot;Vl&quot;</span>)
user.valid? <span class="c"># =&gt; false</span>
user.errors <span class="c"># =&gt; [{:name =&gt; &quot;must have size in range of 3..100&quot;}]</span>
user.name <span class="o">=</span> <span class="s">&quot;Vlad&quot;</span>
user <span class="o">=</span> repo.insert(user)

post <span class="o">=</span> repo.insert(<span class="t">Post</span>.<span class="k">new</span>(author: user, content: <span class="s">&quot;What a beauteful day!&quot;</span>)) <span class="c"># Oops</span>

post.content <span class="o">=</span> <span class="s">&quot;What a beautiful day!&quot;</span>
repo.update(post)

posts <span class="o">=</span> repo.query(<span class="t">Post</span>.where(author: user).join(<span class="n">:author</span>))
puts posts.first.inspect
<span class="c"># =&gt; &lt;Post @author=&lt;User @name=&quot;Vlad&quot;&gt; @content=&quot;What a beautiful day!&quot;&gt;</span></code></pre>

<h2>Testing</h2>

<ol><li>Apply migration from <code>./spec/migration.sql</code></li><li>Run <code>env DATABASE_URL=your_database_url crystal spec</code></li></ol>

<h2>Contributing</h2>

<ol><li>Fork it ( https://github.com/vladfaust/core/fork )</li><li>Create your feature branch (git checkout -b my-new-feature)</li><li>Commit your changes (git commit -am 'Add some feature')</li><li>Push to the branch (git push origin my-new-feature)</li><li>Create a new Pull Request</li></ol>

<h2>Contributors</h2>

<ul><li><a href="https://github.com/vladfaust" target="_blank">@vladfaust</a> Vlad Faust - creator, maintainer</li></ul>
</div>
</body>
</html>
